{"ast":null,"code":"/*!\r\n * Module dependencies.\r\n */\n\n'use strict';\n\nconst MongooseConnection = require('../../connection');\nconst STATES = require('../../connectionstate');\nconst immediate = require('../../helpers/immediate');\nconst setTimeout = require('../../helpers/timers').setTimeout;\n\n/**\r\n * A [node-mongodb-native](https://github.com/mongodb/node-mongodb-native) connection implementation.\r\n *\r\n * @inherits Connection\r\n * @api private\r\n */\n\nfunction NativeConnection() {\n  MongooseConnection.apply(this, arguments);\n  this._listening = false;\n}\n\n/**\r\n * Expose the possible connection states.\r\n * @api public\r\n */\n\nNativeConnection.STATES = STATES;\n\n/*!\r\n * Inherits from Connection.\r\n */\n\nObject.setPrototypeOf(NativeConnection.prototype, MongooseConnection.prototype);\n\n/**\r\n * Switches to a different database using the same connection pool.\r\n *\r\n * Returns a new connection object, with the new db. If you set the `useCache`\r\n * option, `useDb()` will cache connections by `name`.\r\n *\r\n * **Note:** Calling `close()` on a `useDb()` connection will close the base connection as well.\r\n *\r\n * @param {String} name The database name\r\n * @param {Object} [options]\r\n * @param {Boolean} [options.useCache=false] If true, cache results so calling `useDb()` multiple times with the same name only creates 1 connection object.\r\n * @param {Boolean} [options.noListener=false] If true, the new connection object won't listen to any events on the base connection. This is better for memory usage in cases where you're calling `useDb()` for every request.\r\n * @return {Connection} New Connection Object\r\n * @api public\r\n */\n\nNativeConnection.prototype.useDb = function (name, options) {\n  // Return immediately if cached\n  options = options || {};\n  if (options.useCache && this.relatedDbs[name]) {\n    return this.relatedDbs[name];\n  }\n\n  // we have to manually copy all of the attributes...\n  const newConn = new this.constructor();\n  newConn.name = name;\n  newConn.base = this.base;\n  newConn.collections = {};\n  newConn.models = {};\n  newConn.replica = this.replica;\n  newConn.config = Object.assign({}, this.config, newConn.config);\n  newConn.name = this.name;\n  newConn.options = this.options;\n  newConn._readyState = this._readyState;\n  newConn._closeCalled = this._closeCalled;\n  newConn._hasOpened = this._hasOpened;\n  newConn._listening = false;\n  newConn._parent = this;\n  newConn.host = this.host;\n  newConn.port = this.port;\n  newConn.user = this.user;\n  newConn.pass = this.pass;\n\n  // First, when we create another db object, we are not guaranteed to have a\n  // db object to work with. So, in the case where we have a db object and it\n  // is connected, we can just proceed with setting everything up. However, if\n  // we do not have a db or the state is not connected, then we need to wait on\n  // the 'open' event of the connection before doing the rest of the setup\n  // the 'connected' event is the first time we'll have access to the db object\n\n  const _this = this;\n  newConn.client = _this.client;\n  if (this.db && this._readyState === STATES.connected) {\n    wireup();\n  } else {\n    this.once('connected', wireup);\n  }\n  function wireup() {\n    newConn.client = _this.client;\n    const _opts = {};\n    if (options.hasOwnProperty('noListener')) {\n      _opts.noListener = options.noListener;\n    }\n    newConn.db = _this.client.db(name, _opts);\n    newConn.onOpen();\n  }\n  newConn.name = name;\n\n  // push onto the otherDbs stack, this is used when state changes\n  if (options.noListener !== true) {\n    this.otherDbs.push(newConn);\n  }\n  newConn.otherDbs.push(this);\n\n  // push onto the relatedDbs cache, this is used when state changes\n  if (options && options.useCache) {\n    this.relatedDbs[newConn.name] = newConn;\n    newConn.relatedDbs = this.relatedDbs;\n  }\n  return newConn;\n};\n\n/**\r\n * Closes the connection\r\n *\r\n * @param {Boolean} [force]\r\n * @param {Function} [fn]\r\n * @return {Connection} this\r\n * @api private\r\n */\n\nNativeConnection.prototype.doClose = function (force, fn) {\n  if (this.client == null) {\n    immediate(() => fn());\n    return this;\n  }\n  let skipCloseClient = false;\n  if (force != null && typeof force === 'object') {\n    skipCloseClient = force.skipCloseClient;\n    force = force.force;\n  }\n  if (skipCloseClient) {\n    immediate(() => fn());\n    return this;\n  }\n  this.client.close(force, (err, res) => {\n    // Defer because the driver will wait at least 1ms before finishing closing\n    // the pool, see https://github.com/mongodb-js/mongodb-core/blob/a8f8e4ce41936babc3b9112bf42d609779f03b39/lib/connection/pool.js#L1026-L1030.\n    // If there's queued operations, you may still get some background work\n    // after the callback is called.\n    setTimeout(() => fn(err, res), 1);\n  });\n  return this;\n};\n\n/*!\r\n * Module exports.\r\n */\n\nmodule.exports = NativeConnection;","map":{"version":3,"names":["MongooseConnection","require","STATES","immediate","setTimeout","NativeConnection","apply","arguments","_listening","Object","setPrototypeOf","prototype","useDb","name","options","useCache","relatedDbs","newConn","constructor","base","collections","models","replica","config","assign","_readyState","_closeCalled","_hasOpened","_parent","host","port","user","pass","_this","client","db","connected","wireup","once","_opts","hasOwnProperty","noListener","onOpen","otherDbs","push","doClose","force","fn","skipCloseClient","close","err","res","module","exports"],"sources":["C:/Users/91930/Desktop/Github projects/Pharmacy Demo/back-end/node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js"],"sourcesContent":["/*!\r\n * Module dependencies.\r\n */\r\n\r\n'use strict';\r\n\r\nconst MongooseConnection = require('../../connection');\r\nconst STATES = require('../../connectionstate');\r\nconst immediate = require('../../helpers/immediate');\r\nconst setTimeout = require('../../helpers/timers').setTimeout;\r\n\r\n/**\r\n * A [node-mongodb-native](https://github.com/mongodb/node-mongodb-native) connection implementation.\r\n *\r\n * @inherits Connection\r\n * @api private\r\n */\r\n\r\nfunction NativeConnection() {\r\n  MongooseConnection.apply(this, arguments);\r\n  this._listening = false;\r\n}\r\n\r\n/**\r\n * Expose the possible connection states.\r\n * @api public\r\n */\r\n\r\nNativeConnection.STATES = STATES;\r\n\r\n/*!\r\n * Inherits from Connection.\r\n */\r\n\r\nObject.setPrototypeOf(NativeConnection.prototype, MongooseConnection.prototype);\r\n\r\n/**\r\n * Switches to a different database using the same connection pool.\r\n *\r\n * Returns a new connection object, with the new db. If you set the `useCache`\r\n * option, `useDb()` will cache connections by `name`.\r\n *\r\n * **Note:** Calling `close()` on a `useDb()` connection will close the base connection as well.\r\n *\r\n * @param {String} name The database name\r\n * @param {Object} [options]\r\n * @param {Boolean} [options.useCache=false] If true, cache results so calling `useDb()` multiple times with the same name only creates 1 connection object.\r\n * @param {Boolean} [options.noListener=false] If true, the new connection object won't listen to any events on the base connection. This is better for memory usage in cases where you're calling `useDb()` for every request.\r\n * @return {Connection} New Connection Object\r\n * @api public\r\n */\r\n\r\nNativeConnection.prototype.useDb = function(name, options) {\r\n  // Return immediately if cached\r\n  options = options || {};\r\n  if (options.useCache && this.relatedDbs[name]) {\r\n    return this.relatedDbs[name];\r\n  }\r\n\r\n  // we have to manually copy all of the attributes...\r\n  const newConn = new this.constructor();\r\n  newConn.name = name;\r\n  newConn.base = this.base;\r\n  newConn.collections = {};\r\n  newConn.models = {};\r\n  newConn.replica = this.replica;\r\n  newConn.config = Object.assign({}, this.config, newConn.config);\r\n  newConn.name = this.name;\r\n  newConn.options = this.options;\r\n  newConn._readyState = this._readyState;\r\n  newConn._closeCalled = this._closeCalled;\r\n  newConn._hasOpened = this._hasOpened;\r\n  newConn._listening = false;\r\n  newConn._parent = this;\r\n\r\n  newConn.host = this.host;\r\n  newConn.port = this.port;\r\n  newConn.user = this.user;\r\n  newConn.pass = this.pass;\r\n\r\n  // First, when we create another db object, we are not guaranteed to have a\r\n  // db object to work with. So, in the case where we have a db object and it\r\n  // is connected, we can just proceed with setting everything up. However, if\r\n  // we do not have a db or the state is not connected, then we need to wait on\r\n  // the 'open' event of the connection before doing the rest of the setup\r\n  // the 'connected' event is the first time we'll have access to the db object\r\n\r\n  const _this = this;\r\n\r\n  newConn.client = _this.client;\r\n\r\n  if (this.db && this._readyState === STATES.connected) {\r\n    wireup();\r\n  } else {\r\n    this.once('connected', wireup);\r\n  }\r\n\r\n  function wireup() {\r\n    newConn.client = _this.client;\r\n    const _opts = {};\r\n    if (options.hasOwnProperty('noListener')) {\r\n      _opts.noListener = options.noListener;\r\n    }\r\n    newConn.db = _this.client.db(name, _opts);\r\n    newConn.onOpen();\r\n  }\r\n\r\n  newConn.name = name;\r\n\r\n  // push onto the otherDbs stack, this is used when state changes\r\n  if (options.noListener !== true) {\r\n    this.otherDbs.push(newConn);\r\n  }\r\n  newConn.otherDbs.push(this);\r\n\r\n  // push onto the relatedDbs cache, this is used when state changes\r\n  if (options && options.useCache) {\r\n    this.relatedDbs[newConn.name] = newConn;\r\n    newConn.relatedDbs = this.relatedDbs;\r\n  }\r\n\r\n  return newConn;\r\n};\r\n\r\n/**\r\n * Closes the connection\r\n *\r\n * @param {Boolean} [force]\r\n * @param {Function} [fn]\r\n * @return {Connection} this\r\n * @api private\r\n */\r\n\r\nNativeConnection.prototype.doClose = function(force, fn) {\r\n  if (this.client == null) {\r\n    immediate(() => fn());\r\n    return this;\r\n  }\r\n\r\n  let skipCloseClient = false;\r\n  if (force != null && typeof force === 'object') {\r\n    skipCloseClient = force.skipCloseClient;\r\n    force = force.force;\r\n  }\r\n\r\n  if (skipCloseClient) {\r\n    immediate(() => fn());\r\n    return this;\r\n  }\r\n\r\n  this.client.close(force, (err, res) => {\r\n    // Defer because the driver will wait at least 1ms before finishing closing\r\n    // the pool, see https://github.com/mongodb-js/mongodb-core/blob/a8f8e4ce41936babc3b9112bf42d609779f03b39/lib/connection/pool.js#L1026-L1030.\r\n    // If there's queued operations, you may still get some background work\r\n    // after the callback is called.\r\n    setTimeout(() => fn(err, res), 1);\r\n  });\r\n  return this;\r\n};\r\n\r\n\r\n/*!\r\n * Module exports.\r\n */\r\n\r\nmodule.exports = NativeConnection;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}