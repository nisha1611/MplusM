{"ast":null,"code":"/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra and Zackary Jackson @ScriptedAlchemy\r\n*/\n\n\"use strict\";\n\nconst ExternalsPlugin = require(\"../ExternalsPlugin\");\nconst RuntimeGlobals = require(\"../RuntimeGlobals\");\nconst createSchemaValidation = require(\"../util/create-schema-validation\");\nconst FallbackDependency = require(\"./FallbackDependency\");\nconst FallbackItemDependency = require(\"./FallbackItemDependency\");\nconst FallbackModuleFactory = require(\"./FallbackModuleFactory\");\nconst RemoteModule = require(\"./RemoteModule\");\nconst RemoteRuntimeModule = require(\"./RemoteRuntimeModule\");\nconst RemoteToExternalDependency = require(\"./RemoteToExternalDependency\");\nconst {\n  parseOptions\n} = require(\"./options\");\n\n/** @typedef {import(\"../../declarations/plugins/container/ContainerReferencePlugin\").ContainerReferencePluginOptions} ContainerReferencePluginOptions */\n/** @typedef {import(\"../../declarations/plugins/container/ContainerReferencePlugin\").RemotesConfig} RemotesConfig */\n/** @typedef {import(\"../Compiler\")} Compiler */\n\nconst validate = createSchemaValidation(require(\"../../schemas/plugins/container/ContainerReferencePlugin.check.js\"), () => require(\"../../schemas/plugins/container/ContainerReferencePlugin.json\"), {\n  name: \"Container Reference Plugin\",\n  baseDataPath: \"options\"\n});\nconst slashCode = \"/\".charCodeAt(0);\nclass ContainerReferencePlugin {\n  /**\r\n   * @param {ContainerReferencePluginOptions} options options\r\n   */\n  constructor(options) {\n    validate(options);\n    this._remoteType = options.remoteType;\n    this._remotes = parseOptions(options.remotes, item => ({\n      external: Array.isArray(item) ? item : [item],\n      shareScope: options.shareScope || \"default\"\n    }), item => ({\n      external: Array.isArray(item.external) ? item.external : [item.external],\n      shareScope: item.shareScope || options.shareScope || \"default\"\n    }));\n  }\n\n  /**\r\n   * Apply the plugin\r\n   * @param {Compiler} compiler the compiler instance\r\n   * @returns {void}\r\n   */\n  apply(compiler) {\n    const {\n      _remotes: remotes,\n      _remoteType: remoteType\n    } = this;\n\n    /** @type {Record<string, string>} */\n    const remoteExternals = {};\n    for (const [key, config] of remotes) {\n      let i = 0;\n      for (const external of config.external) {\n        if (external.startsWith(\"internal \")) continue;\n        remoteExternals[`webpack/container/reference/${key}${i ? `/fallback-${i}` : \"\"}`] = external;\n        i++;\n      }\n    }\n    new ExternalsPlugin(remoteType, remoteExternals).apply(compiler);\n    compiler.hooks.compilation.tap(\"ContainerReferencePlugin\", (compilation, _ref) => {\n      let {\n        normalModuleFactory\n      } = _ref;\n      compilation.dependencyFactories.set(RemoteToExternalDependency, normalModuleFactory);\n      compilation.dependencyFactories.set(FallbackItemDependency, normalModuleFactory);\n      compilation.dependencyFactories.set(FallbackDependency, new FallbackModuleFactory());\n      normalModuleFactory.hooks.factorize.tap(\"ContainerReferencePlugin\", data => {\n        if (!data.request.includes(\"!\")) {\n          for (const [key, config] of remotes) {\n            if (data.request.startsWith(`${key}`) && (data.request.length === key.length || data.request.charCodeAt(key.length) === slashCode)) {\n              return new RemoteModule(data.request, config.external.map((external, i) => external.startsWith(\"internal \") ? external.slice(9) : `webpack/container/reference/${key}${i ? `/fallback-${i}` : \"\"}`), `.${data.request.slice(key.length)}`, config.shareScope);\n            }\n          }\n        }\n      });\n      compilation.hooks.runtimeRequirementInTree.for(RuntimeGlobals.ensureChunkHandlers).tap(\"ContainerReferencePlugin\", (chunk, set) => {\n        set.add(RuntimeGlobals.module);\n        set.add(RuntimeGlobals.moduleFactoriesAddOnly);\n        set.add(RuntimeGlobals.hasOwnProperty);\n        set.add(RuntimeGlobals.initializeSharing);\n        set.add(RuntimeGlobals.shareScopeMap);\n        compilation.addRuntimeModule(chunk, new RemoteRuntimeModule());\n      });\n    });\n  }\n}\nmodule.exports = ContainerReferencePlugin;","map":{"version":3,"names":["ExternalsPlugin","require","RuntimeGlobals","createSchemaValidation","FallbackDependency","FallbackItemDependency","FallbackModuleFactory","RemoteModule","RemoteRuntimeModule","RemoteToExternalDependency","parseOptions","validate","name","baseDataPath","slashCode","charCodeAt","ContainerReferencePlugin","constructor","options","_remoteType","remoteType","_remotes","remotes","item","external","Array","isArray","shareScope","apply","compiler","remoteExternals","key","config","i","startsWith","hooks","compilation","tap","normalModuleFactory","dependencyFactories","set","factorize","data","request","includes","length","map","slice","runtimeRequirementInTree","for","ensureChunkHandlers","chunk","add","module","moduleFactoriesAddOnly","hasOwnProperty","initializeSharing","shareScopeMap","addRuntimeModule","exports"],"sources":["C:/Users/91930/Desktop/Github projects/Pharmacy Demo/front-end/node_modules/webpack/lib/container/ContainerReferencePlugin.js"],"sourcesContent":["/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra and Zackary Jackson @ScriptedAlchemy\r\n*/\r\n\r\n\"use strict\";\r\n\r\nconst ExternalsPlugin = require(\"../ExternalsPlugin\");\r\nconst RuntimeGlobals = require(\"../RuntimeGlobals\");\r\nconst createSchemaValidation = require(\"../util/create-schema-validation\");\r\nconst FallbackDependency = require(\"./FallbackDependency\");\r\nconst FallbackItemDependency = require(\"./FallbackItemDependency\");\r\nconst FallbackModuleFactory = require(\"./FallbackModuleFactory\");\r\nconst RemoteModule = require(\"./RemoteModule\");\r\nconst RemoteRuntimeModule = require(\"./RemoteRuntimeModule\");\r\nconst RemoteToExternalDependency = require(\"./RemoteToExternalDependency\");\r\nconst { parseOptions } = require(\"./options\");\r\n\r\n/** @typedef {import(\"../../declarations/plugins/container/ContainerReferencePlugin\").ContainerReferencePluginOptions} ContainerReferencePluginOptions */\r\n/** @typedef {import(\"../../declarations/plugins/container/ContainerReferencePlugin\").RemotesConfig} RemotesConfig */\r\n/** @typedef {import(\"../Compiler\")} Compiler */\r\n\r\nconst validate = createSchemaValidation(\r\n\trequire(\"../../schemas/plugins/container/ContainerReferencePlugin.check.js\"),\r\n\t() =>\r\n\t\trequire(\"../../schemas/plugins/container/ContainerReferencePlugin.json\"),\r\n\t{\r\n\t\tname: \"Container Reference Plugin\",\r\n\t\tbaseDataPath: \"options\"\r\n\t}\r\n);\r\n\r\nconst slashCode = \"/\".charCodeAt(0);\r\n\r\nclass ContainerReferencePlugin {\r\n\t/**\r\n\t * @param {ContainerReferencePluginOptions} options options\r\n\t */\r\n\tconstructor(options) {\r\n\t\tvalidate(options);\r\n\r\n\t\tthis._remoteType = options.remoteType;\r\n\t\tthis._remotes = parseOptions(\r\n\t\t\toptions.remotes,\r\n\t\t\titem => ({\r\n\t\t\t\texternal: Array.isArray(item) ? item : [item],\r\n\t\t\t\tshareScope: options.shareScope || \"default\"\r\n\t\t\t}),\r\n\t\t\titem => ({\r\n\t\t\t\texternal: Array.isArray(item.external)\r\n\t\t\t\t\t? item.external\r\n\t\t\t\t\t: [item.external],\r\n\t\t\t\tshareScope: item.shareScope || options.shareScope || \"default\"\r\n\t\t\t})\r\n\t\t);\r\n\t}\r\n\r\n\t/**\r\n\t * Apply the plugin\r\n\t * @param {Compiler} compiler the compiler instance\r\n\t * @returns {void}\r\n\t */\r\n\tapply(compiler) {\r\n\t\tconst { _remotes: remotes, _remoteType: remoteType } = this;\r\n\r\n\t\t/** @type {Record<string, string>} */\r\n\t\tconst remoteExternals = {};\r\n\t\tfor (const [key, config] of remotes) {\r\n\t\t\tlet i = 0;\r\n\t\t\tfor (const external of config.external) {\r\n\t\t\t\tif (external.startsWith(\"internal \")) continue;\r\n\t\t\t\tremoteExternals[\r\n\t\t\t\t\t`webpack/container/reference/${key}${i ? `/fallback-${i}` : \"\"}`\r\n\t\t\t\t] = external;\r\n\t\t\t\ti++;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tnew ExternalsPlugin(remoteType, remoteExternals).apply(compiler);\r\n\r\n\t\tcompiler.hooks.compilation.tap(\r\n\t\t\t\"ContainerReferencePlugin\",\r\n\t\t\t(compilation, { normalModuleFactory }) => {\r\n\t\t\t\tcompilation.dependencyFactories.set(\r\n\t\t\t\t\tRemoteToExternalDependency,\r\n\t\t\t\t\tnormalModuleFactory\r\n\t\t\t\t);\r\n\r\n\t\t\t\tcompilation.dependencyFactories.set(\r\n\t\t\t\t\tFallbackItemDependency,\r\n\t\t\t\t\tnormalModuleFactory\r\n\t\t\t\t);\r\n\r\n\t\t\t\tcompilation.dependencyFactories.set(\r\n\t\t\t\t\tFallbackDependency,\r\n\t\t\t\t\tnew FallbackModuleFactory()\r\n\t\t\t\t);\r\n\r\n\t\t\t\tnormalModuleFactory.hooks.factorize.tap(\r\n\t\t\t\t\t\"ContainerReferencePlugin\",\r\n\t\t\t\t\tdata => {\r\n\t\t\t\t\t\tif (!data.request.includes(\"!\")) {\r\n\t\t\t\t\t\t\tfor (const [key, config] of remotes) {\r\n\t\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\t\tdata.request.startsWith(`${key}`) &&\r\n\t\t\t\t\t\t\t\t\t(data.request.length === key.length ||\r\n\t\t\t\t\t\t\t\t\t\tdata.request.charCodeAt(key.length) === slashCode)\r\n\t\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\t\treturn new RemoteModule(\r\n\t\t\t\t\t\t\t\t\t\tdata.request,\r\n\t\t\t\t\t\t\t\t\t\tconfig.external.map((external, i) =>\r\n\t\t\t\t\t\t\t\t\t\t\texternal.startsWith(\"internal \")\r\n\t\t\t\t\t\t\t\t\t\t\t\t? external.slice(9)\r\n\t\t\t\t\t\t\t\t\t\t\t\t: `webpack/container/reference/${key}${\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ti ? `/fallback-${i}` : \"\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t  }`\r\n\t\t\t\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t\t\t\t\t`.${data.request.slice(key.length)}`,\r\n\t\t\t\t\t\t\t\t\t\tconfig.shareScope\r\n\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\r\n\t\t\t\tcompilation.hooks.runtimeRequirementInTree\r\n\t\t\t\t\t.for(RuntimeGlobals.ensureChunkHandlers)\r\n\t\t\t\t\t.tap(\"ContainerReferencePlugin\", (chunk, set) => {\r\n\t\t\t\t\t\tset.add(RuntimeGlobals.module);\r\n\t\t\t\t\t\tset.add(RuntimeGlobals.moduleFactoriesAddOnly);\r\n\t\t\t\t\t\tset.add(RuntimeGlobals.hasOwnProperty);\r\n\t\t\t\t\t\tset.add(RuntimeGlobals.initializeSharing);\r\n\t\t\t\t\t\tset.add(RuntimeGlobals.shareScopeMap);\r\n\t\t\t\t\t\tcompilation.addRuntimeModule(chunk, new RemoteRuntimeModule());\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\t\t);\r\n\t}\r\n}\r\n\r\nmodule.exports = ContainerReferencePlugin;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}