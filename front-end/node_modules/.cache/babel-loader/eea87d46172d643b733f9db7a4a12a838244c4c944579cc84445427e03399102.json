{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.isResumableError = exports.isNetworkTimeoutError = exports.isSDAMUnrecoverableError = exports.isNodeShuttingDownError = exports.isRetryableReadError = exports.isRetryableWriteError = exports.needsRetryableWriteLabel = exports.MongoWriteConcernError = exports.MongoServerSelectionError = exports.MongoSystemError = exports.MongoMissingDependencyError = exports.MongoMissingCredentialsError = exports.MongoCompatibilityError = exports.MongoInvalidArgumentError = exports.MongoParseError = exports.MongoNetworkTimeoutError = exports.MongoNetworkError = exports.isNetworkErrorBeforeHandshake = exports.MongoTopologyClosedError = exports.MongoCursorExhaustedError = exports.MongoServerClosedError = exports.MongoCursorInUseError = exports.MongoUnexpectedServerResponseError = exports.MongoGridFSChunkError = exports.MongoGridFSStreamError = exports.MongoTailableCursorError = exports.MongoChangeStreamError = exports.MongoAWSError = exports.MongoKerberosError = exports.MongoExpiredSessionError = exports.MongoTransactionError = exports.MongoNotConnectedError = exports.MongoDecompressionError = exports.MongoBatchReExecutionError = exports.MongoRuntimeError = exports.MongoAPIError = exports.MongoDriverError = exports.MongoServerError = exports.MongoError = exports.MongoErrorLabel = exports.GET_MORE_RESUMABLE_CODES = exports.MONGODB_ERROR_CODES = exports.NODE_IS_RECOVERING_ERROR_MESSAGE = exports.LEGACY_NOT_PRIMARY_OR_SECONDARY_ERROR_MESSAGE = exports.LEGACY_NOT_WRITABLE_PRIMARY_ERROR_MESSAGE = void 0;\n/** @internal */\nconst kErrorLabels = Symbol('errorLabels');\n/**\r\n * @internal\r\n * The legacy error message from the server that indicates the node is not a writable primary\r\n * https://github.com/mongodb/specifications/blob/b07c26dc40d04ac20349f989db531c9845fdd755/source/server-discovery-and-monitoring/server-discovery-and-monitoring.rst#not-writable-primary-and-node-is-recovering\r\n */\nexports.LEGACY_NOT_WRITABLE_PRIMARY_ERROR_MESSAGE = new RegExp('not master', 'i');\n/**\r\n * @internal\r\n * The legacy error message from the server that indicates the node is not a primary or secondary\r\n * https://github.com/mongodb/specifications/blob/b07c26dc40d04ac20349f989db531c9845fdd755/source/server-discovery-and-monitoring/server-discovery-and-monitoring.rst#not-writable-primary-and-node-is-recovering\r\n */\nexports.LEGACY_NOT_PRIMARY_OR_SECONDARY_ERROR_MESSAGE = new RegExp('not master or secondary', 'i');\n/**\r\n * @internal\r\n * The error message from the server that indicates the node is recovering\r\n * https://github.com/mongodb/specifications/blob/b07c26dc40d04ac20349f989db531c9845fdd755/source/server-discovery-and-monitoring/server-discovery-and-monitoring.rst#not-writable-primary-and-node-is-recovering\r\n */\nexports.NODE_IS_RECOVERING_ERROR_MESSAGE = new RegExp('node is recovering', 'i');\n/** @internal MongoDB Error Codes */\nexports.MONGODB_ERROR_CODES = Object.freeze({\n  HostUnreachable: 6,\n  HostNotFound: 7,\n  NetworkTimeout: 89,\n  ShutdownInProgress: 91,\n  PrimarySteppedDown: 189,\n  ExceededTimeLimit: 262,\n  SocketException: 9001,\n  NotWritablePrimary: 10107,\n  InterruptedAtShutdown: 11600,\n  InterruptedDueToReplStateChange: 11602,\n  NotPrimaryNoSecondaryOk: 13435,\n  NotPrimaryOrSecondary: 13436,\n  StaleShardVersion: 63,\n  StaleEpoch: 150,\n  StaleConfig: 13388,\n  RetryChangeStream: 234,\n  FailedToSatisfyReadPreference: 133,\n  CursorNotFound: 43,\n  LegacyNotPrimary: 10058,\n  WriteConcernFailed: 64,\n  NamespaceNotFound: 26,\n  IllegalOperation: 20,\n  MaxTimeMSExpired: 50,\n  UnknownReplWriteConcern: 79,\n  UnsatisfiableWriteConcern: 100\n});\n// From spec@https://github.com/mongodb/specifications/blob/f93d78191f3db2898a59013a7ed5650352ef6da8/source/change-streams/change-streams.rst#resumable-error\nexports.GET_MORE_RESUMABLE_CODES = new Set([exports.MONGODB_ERROR_CODES.HostUnreachable, exports.MONGODB_ERROR_CODES.HostNotFound, exports.MONGODB_ERROR_CODES.NetworkTimeout, exports.MONGODB_ERROR_CODES.ShutdownInProgress, exports.MONGODB_ERROR_CODES.PrimarySteppedDown, exports.MONGODB_ERROR_CODES.ExceededTimeLimit, exports.MONGODB_ERROR_CODES.SocketException, exports.MONGODB_ERROR_CODES.NotWritablePrimary, exports.MONGODB_ERROR_CODES.InterruptedAtShutdown, exports.MONGODB_ERROR_CODES.InterruptedDueToReplStateChange, exports.MONGODB_ERROR_CODES.NotPrimaryNoSecondaryOk, exports.MONGODB_ERROR_CODES.NotPrimaryOrSecondary, exports.MONGODB_ERROR_CODES.StaleShardVersion, exports.MONGODB_ERROR_CODES.StaleEpoch, exports.MONGODB_ERROR_CODES.StaleConfig, exports.MONGODB_ERROR_CODES.RetryChangeStream, exports.MONGODB_ERROR_CODES.FailedToSatisfyReadPreference, exports.MONGODB_ERROR_CODES.CursorNotFound]);\n/** @public */\nexports.MongoErrorLabel = Object.freeze({\n  RetryableWriteError: 'RetryableWriteError',\n  TransientTransactionError: 'TransientTransactionError',\n  UnknownTransactionCommitResult: 'UnknownTransactionCommitResult',\n  ResumableChangeStreamError: 'ResumableChangeStreamError',\n  HandshakeError: 'HandshakeError',\n  ResetPool: 'ResetPool',\n  NoWritesPerformed: 'NoWritesPerformed'\n});\n/**\r\n * @public\r\n * @category Error\r\n *\r\n * @privateRemarks\r\n * mongodb-client-encryption has a dependency on this error, it uses the constructor with a string argument\r\n */\nclass MongoError extends Error {\n  constructor(message) {\n    if (message instanceof Error) {\n      super(message.message);\n      this.cause = message;\n    } else {\n      super(message);\n    }\n    this[kErrorLabels] = new Set();\n  }\n  get name() {\n    return 'MongoError';\n  }\n  /** Legacy name for server error responses */\n  get errmsg() {\n    return this.message;\n  }\n  /**\r\n   * Checks the error to see if it has an error label\r\n   *\r\n   * @param label - The error label to check for\r\n   * @returns returns true if the error has the provided error label\r\n   */\n  hasErrorLabel(label) {\n    return this[kErrorLabels].has(label);\n  }\n  addErrorLabel(label) {\n    this[kErrorLabels].add(label);\n  }\n  get errorLabels() {\n    return Array.from(this[kErrorLabels]);\n  }\n}\nexports.MongoError = MongoError;\n/**\r\n * An error coming from the mongo server\r\n *\r\n * @public\r\n * @category Error\r\n */\nclass MongoServerError extends MongoError {\n  constructor(message) {\n    super(message.message || message.errmsg || message.$err || 'n/a');\n    if (message.errorLabels) {\n      this[kErrorLabels] = new Set(message.errorLabels);\n    }\n    for (const name in message) {\n      if (name !== 'errorLabels' && name !== 'errmsg' && name !== 'message') this[name] = message[name];\n    }\n  }\n  get name() {\n    return 'MongoServerError';\n  }\n}\nexports.MongoServerError = MongoServerError;\n/**\r\n * An error generated by the driver\r\n *\r\n * @public\r\n * @category Error\r\n */\nclass MongoDriverError extends MongoError {\n  constructor(message) {\n    super(message);\n  }\n  get name() {\n    return 'MongoDriverError';\n  }\n}\nexports.MongoDriverError = MongoDriverError;\n/**\r\n * An error generated when the driver API is used incorrectly\r\n *\r\n * @privateRemarks\r\n * Should **never** be directly instantiated\r\n *\r\n * @public\r\n * @category Error\r\n */\nclass MongoAPIError extends MongoDriverError {\n  constructor(message) {\n    super(message);\n  }\n  get name() {\n    return 'MongoAPIError';\n  }\n}\nexports.MongoAPIError = MongoAPIError;\n/**\r\n * An error generated when the driver encounters unexpected input\r\n * or reaches an unexpected/invalid internal state\r\n *\r\n * @privateRemarks\r\n * Should **never** be directly instantiated.\r\n *\r\n * @public\r\n * @category Error\r\n */\nclass MongoRuntimeError extends MongoDriverError {\n  constructor(message) {\n    super(message);\n  }\n  get name() {\n    return 'MongoRuntimeError';\n  }\n}\nexports.MongoRuntimeError = MongoRuntimeError;\n/**\r\n * An error generated when a batch command is re-executed after one of the commands in the batch\r\n * has failed\r\n *\r\n * @public\r\n * @category Error\r\n */\nclass MongoBatchReExecutionError extends MongoAPIError {\n  constructor() {\n    let message = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'This batch has already been executed, create new batch to execute';\n    super(message);\n  }\n  get name() {\n    return 'MongoBatchReExecutionError';\n  }\n}\nexports.MongoBatchReExecutionError = MongoBatchReExecutionError;\n/**\r\n * An error generated when the driver fails to decompress\r\n * data received from the server.\r\n *\r\n * @public\r\n * @category Error\r\n */\nclass MongoDecompressionError extends MongoRuntimeError {\n  constructor(message) {\n    super(message);\n  }\n  get name() {\n    return 'MongoDecompressionError';\n  }\n}\nexports.MongoDecompressionError = MongoDecompressionError;\n/**\r\n * An error thrown when the user attempts to operate on a database or collection through a MongoClient\r\n * that has not yet successfully called the \"connect\" method\r\n *\r\n * @public\r\n * @category Error\r\n */\nclass MongoNotConnectedError extends MongoAPIError {\n  constructor(message) {\n    super(message);\n  }\n  get name() {\n    return 'MongoNotConnectedError';\n  }\n}\nexports.MongoNotConnectedError = MongoNotConnectedError;\n/**\r\n * An error generated when the user makes a mistake in the usage of transactions.\r\n * (e.g. attempting to commit a transaction with a readPreference other than primary)\r\n *\r\n * @public\r\n * @category Error\r\n */\nclass MongoTransactionError extends MongoAPIError {\n  constructor(message) {\n    super(message);\n  }\n  get name() {\n    return 'MongoTransactionError';\n  }\n}\nexports.MongoTransactionError = MongoTransactionError;\n/**\r\n * An error generated when the user attempts to operate\r\n * on a session that has expired or has been closed.\r\n *\r\n * @public\r\n * @category Error\r\n */\nclass MongoExpiredSessionError extends MongoAPIError {\n  constructor() {\n    let message = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'Cannot use a session that has ended';\n    super(message);\n  }\n  get name() {\n    return 'MongoExpiredSessionError';\n  }\n}\nexports.MongoExpiredSessionError = MongoExpiredSessionError;\n/**\r\n * A error generated when the user attempts to authenticate\r\n * via Kerberos, but fails to connect to the Kerberos client.\r\n *\r\n * @public\r\n * @category Error\r\n */\nclass MongoKerberosError extends MongoRuntimeError {\n  constructor(message) {\n    super(message);\n  }\n  get name() {\n    return 'MongoKerberosError';\n  }\n}\nexports.MongoKerberosError = MongoKerberosError;\n/**\r\n * A error generated when the user attempts to authenticate\r\n * via AWS, but fails\r\n *\r\n * @public\r\n * @category Error\r\n */\nclass MongoAWSError extends MongoRuntimeError {\n  constructor(message) {\n    super(message);\n  }\n  get name() {\n    return 'MongoAWSError';\n  }\n}\nexports.MongoAWSError = MongoAWSError;\n/**\r\n * An error generated when a ChangeStream operation fails to execute.\r\n *\r\n * @public\r\n * @category Error\r\n */\nclass MongoChangeStreamError extends MongoRuntimeError {\n  constructor(message) {\n    super(message);\n  }\n  get name() {\n    return 'MongoChangeStreamError';\n  }\n}\nexports.MongoChangeStreamError = MongoChangeStreamError;\n/**\r\n * An error thrown when the user calls a function or method not supported on a tailable cursor\r\n *\r\n * @public\r\n * @category Error\r\n */\nclass MongoTailableCursorError extends MongoAPIError {\n  constructor() {\n    let message = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'Tailable cursor does not support this operation';\n    super(message);\n  }\n  get name() {\n    return 'MongoTailableCursorError';\n  }\n}\nexports.MongoTailableCursorError = MongoTailableCursorError;\n/** An error generated when a GridFSStream operation fails to execute.\r\n *\r\n * @public\r\n * @category Error\r\n */\nclass MongoGridFSStreamError extends MongoRuntimeError {\n  constructor(message) {\n    super(message);\n  }\n  get name() {\n    return 'MongoGridFSStreamError';\n  }\n}\nexports.MongoGridFSStreamError = MongoGridFSStreamError;\n/**\r\n * An error generated when a malformed or invalid chunk is\r\n * encountered when reading from a GridFSStream.\r\n *\r\n * @public\r\n * @category Error\r\n */\nclass MongoGridFSChunkError extends MongoRuntimeError {\n  constructor(message) {\n    super(message);\n  }\n  get name() {\n    return 'MongoGridFSChunkError';\n  }\n}\nexports.MongoGridFSChunkError = MongoGridFSChunkError;\n/**\r\n * An error generated when a **parsable** unexpected response comes from the server.\r\n * This is generally an error where the driver in a state expecting a certain behavior to occur in\r\n * the next message from MongoDB but it receives something else.\r\n * This error **does not** represent an issue with wire message formatting.\r\n *\r\n * #### Example\r\n * When an operation fails, it is the driver's job to retry it. It must perform serverSelection\r\n * again to make sure that it attempts the operation against a server in a good state. If server\r\n * selection returns a server that does not support retryable operations, this error is used.\r\n * This scenario is unlikely as retryable support would also have been determined on the first attempt\r\n * but it is possible the state change could report a selectable server that does not support retries.\r\n *\r\n * @public\r\n * @category Error\r\n */\nclass MongoUnexpectedServerResponseError extends MongoRuntimeError {\n  constructor(message) {\n    super(message);\n  }\n  get name() {\n    return 'MongoUnexpectedServerResponseError';\n  }\n}\nexports.MongoUnexpectedServerResponseError = MongoUnexpectedServerResponseError;\n/**\r\n * An error thrown when the user attempts to add options to a cursor that has already been\r\n * initialized\r\n *\r\n * @public\r\n * @category Error\r\n */\nclass MongoCursorInUseError extends MongoAPIError {\n  constructor() {\n    let message = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'Cursor is already initialized';\n    super(message);\n  }\n  get name() {\n    return 'MongoCursorInUseError';\n  }\n}\nexports.MongoCursorInUseError = MongoCursorInUseError;\n/**\r\n * An error generated when an attempt is made to operate\r\n * on a closed/closing server.\r\n *\r\n * @public\r\n * @category Error\r\n */\nclass MongoServerClosedError extends MongoAPIError {\n  constructor() {\n    let message = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'Server is closed';\n    super(message);\n  }\n  get name() {\n    return 'MongoServerClosedError';\n  }\n}\nexports.MongoServerClosedError = MongoServerClosedError;\n/**\r\n * An error thrown when an attempt is made to read from a cursor that has been exhausted\r\n *\r\n * @public\r\n * @category Error\r\n */\nclass MongoCursorExhaustedError extends MongoAPIError {\n  constructor(message) {\n    super(message || 'Cursor is exhausted');\n  }\n  get name() {\n    return 'MongoCursorExhaustedError';\n  }\n}\nexports.MongoCursorExhaustedError = MongoCursorExhaustedError;\n/**\r\n * An error generated when an attempt is made to operate on a\r\n * dropped, or otherwise unavailable, database.\r\n *\r\n * @public\r\n * @category Error\r\n */\nclass MongoTopologyClosedError extends MongoAPIError {\n  constructor() {\n    let message = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'Topology is closed';\n    super(message);\n  }\n  get name() {\n    return 'MongoTopologyClosedError';\n  }\n}\nexports.MongoTopologyClosedError = MongoTopologyClosedError;\n/** @internal */\nconst kBeforeHandshake = Symbol('beforeHandshake');\nfunction isNetworkErrorBeforeHandshake(err) {\n  return err[kBeforeHandshake] === true;\n}\nexports.isNetworkErrorBeforeHandshake = isNetworkErrorBeforeHandshake;\n/**\r\n * An error indicating an issue with the network, including TCP errors and timeouts.\r\n * @public\r\n * @category Error\r\n */\nclass MongoNetworkError extends MongoError {\n  constructor(message, options) {\n    super(message);\n    if (options && typeof options.beforeHandshake === 'boolean') {\n      this[kBeforeHandshake] = options.beforeHandshake;\n    }\n  }\n  get name() {\n    return 'MongoNetworkError';\n  }\n}\nexports.MongoNetworkError = MongoNetworkError;\n/**\r\n * An error indicating a network timeout occurred\r\n * @public\r\n * @category Error\r\n *\r\n * @privateRemarks\r\n * mongodb-client-encryption has a dependency on this error with an instanceof check\r\n */\nclass MongoNetworkTimeoutError extends MongoNetworkError {\n  constructor(message, options) {\n    super(message, options);\n  }\n  get name() {\n    return 'MongoNetworkTimeoutError';\n  }\n}\nexports.MongoNetworkTimeoutError = MongoNetworkTimeoutError;\n/**\r\n * An error used when attempting to parse a value (like a connection string)\r\n * @public\r\n * @category Error\r\n */\nclass MongoParseError extends MongoDriverError {\n  constructor(message) {\n    super(message);\n  }\n  get name() {\n    return 'MongoParseError';\n  }\n}\nexports.MongoParseError = MongoParseError;\n/**\r\n * An error generated when the user supplies malformed or unexpected arguments\r\n * or when a required argument or field is not provided.\r\n *\r\n *\r\n * @public\r\n * @category Error\r\n */\nclass MongoInvalidArgumentError extends MongoAPIError {\n  constructor(message) {\n    super(message);\n  }\n  get name() {\n    return 'MongoInvalidArgumentError';\n  }\n}\nexports.MongoInvalidArgumentError = MongoInvalidArgumentError;\n/**\r\n * An error generated when a feature that is not enabled or allowed for the current server\r\n * configuration is used\r\n *\r\n *\r\n * @public\r\n * @category Error\r\n */\nclass MongoCompatibilityError extends MongoAPIError {\n  constructor(message) {\n    super(message);\n  }\n  get name() {\n    return 'MongoCompatibilityError';\n  }\n}\nexports.MongoCompatibilityError = MongoCompatibilityError;\n/**\r\n * An error generated when the user fails to provide authentication credentials before attempting\r\n * to connect to a mongo server instance.\r\n *\r\n *\r\n * @public\r\n * @category Error\r\n */\nclass MongoMissingCredentialsError extends MongoAPIError {\n  constructor(message) {\n    super(message);\n  }\n  get name() {\n    return 'MongoMissingCredentialsError';\n  }\n}\nexports.MongoMissingCredentialsError = MongoMissingCredentialsError;\n/**\r\n * An error generated when a required module or dependency is not present in the local environment\r\n *\r\n * @public\r\n * @category Error\r\n */\nclass MongoMissingDependencyError extends MongoAPIError {\n  constructor(message) {\n    super(message);\n  }\n  get name() {\n    return 'MongoMissingDependencyError';\n  }\n}\nexports.MongoMissingDependencyError = MongoMissingDependencyError;\n/**\r\n * An error signifying a general system issue\r\n * @public\r\n * @category Error\r\n */\nclass MongoSystemError extends MongoError {\n  constructor(message, reason) {\n    var _a;\n    if (reason && reason.error) {\n      super(reason.error.message || reason.error);\n    } else {\n      super(message);\n    }\n    if (reason) {\n      this.reason = reason;\n    }\n    this.code = (_a = reason.error) === null || _a === void 0 ? void 0 : _a.code;\n  }\n  get name() {\n    return 'MongoSystemError';\n  }\n}\nexports.MongoSystemError = MongoSystemError;\n/**\r\n * An error signifying a client-side server selection error\r\n * @public\r\n * @category Error\r\n */\nclass MongoServerSelectionError extends MongoSystemError {\n  constructor(message, reason) {\n    super(message, reason);\n  }\n  get name() {\n    return 'MongoServerSelectionError';\n  }\n}\nexports.MongoServerSelectionError = MongoServerSelectionError;\nfunction makeWriteConcernResultObject(input) {\n  const output = Object.assign({}, input);\n  if (output.ok === 0) {\n    output.ok = 1;\n    delete output.errmsg;\n    delete output.code;\n    delete output.codeName;\n  }\n  return output;\n}\n/**\r\n * An error thrown when the server reports a writeConcernError\r\n * @public\r\n * @category Error\r\n */\nclass MongoWriteConcernError extends MongoServerError {\n  constructor(message, result) {\n    if (result && Array.isArray(result.errorLabels)) {\n      message.errorLabels = result.errorLabels;\n    }\n    super(message);\n    this.errInfo = message.errInfo;\n    if (result != null) {\n      this.result = makeWriteConcernResultObject(result);\n    }\n  }\n  get name() {\n    return 'MongoWriteConcernError';\n  }\n}\nexports.MongoWriteConcernError = MongoWriteConcernError;\n// https://github.com/mongodb/specifications/blob/master/source/retryable-reads/retryable-reads.rst#retryable-error\nconst RETRYABLE_READ_ERROR_CODES = new Set([exports.MONGODB_ERROR_CODES.HostUnreachable, exports.MONGODB_ERROR_CODES.HostNotFound, exports.MONGODB_ERROR_CODES.NetworkTimeout, exports.MONGODB_ERROR_CODES.ShutdownInProgress, exports.MONGODB_ERROR_CODES.PrimarySteppedDown, exports.MONGODB_ERROR_CODES.SocketException, exports.MONGODB_ERROR_CODES.NotWritablePrimary, exports.MONGODB_ERROR_CODES.InterruptedAtShutdown, exports.MONGODB_ERROR_CODES.InterruptedDueToReplStateChange, exports.MONGODB_ERROR_CODES.NotPrimaryNoSecondaryOk, exports.MONGODB_ERROR_CODES.NotPrimaryOrSecondary]);\n// see: https://github.com/mongodb/specifications/blob/master/source/retryable-writes/retryable-writes.rst#terms\nconst RETRYABLE_WRITE_ERROR_CODES = new Set([...RETRYABLE_READ_ERROR_CODES, exports.MONGODB_ERROR_CODES.ExceededTimeLimit]);\nfunction needsRetryableWriteLabel(error, maxWireVersion) {\n  var _a, _b, _c;\n  // pre-4.4 server, then the driver adds an error label for every valid case\n  // execute operation will only inspect the label, code/message logic is handled here\n  if (error instanceof MongoNetworkError) {\n    return true;\n  }\n  if (error instanceof MongoError) {\n    if ((maxWireVersion >= 9 || error.hasErrorLabel(exports.MongoErrorLabel.RetryableWriteError)) && !error.hasErrorLabel(exports.MongoErrorLabel.HandshakeError)) {\n      // If we already have the error label no need to add it again. 4.4+ servers add the label.\n      // In the case where we have a handshake error, need to fall down to the logic checking\n      // the codes.\n      return false;\n    }\n  }\n  if (error instanceof MongoWriteConcernError) {\n    return RETRYABLE_WRITE_ERROR_CODES.has((_c = (_b = (_a = error.result) === null || _a === void 0 ? void 0 : _a.code) !== null && _b !== void 0 ? _b : error.code) !== null && _c !== void 0 ? _c : 0);\n  }\n  if (error instanceof MongoError && typeof error.code === 'number') {\n    return RETRYABLE_WRITE_ERROR_CODES.has(error.code);\n  }\n  const isNotWritablePrimaryError = exports.LEGACY_NOT_WRITABLE_PRIMARY_ERROR_MESSAGE.test(error.message);\n  if (isNotWritablePrimaryError) {\n    return true;\n  }\n  const isNodeIsRecoveringError = exports.NODE_IS_RECOVERING_ERROR_MESSAGE.test(error.message);\n  if (isNodeIsRecoveringError) {\n    return true;\n  }\n  return false;\n}\nexports.needsRetryableWriteLabel = needsRetryableWriteLabel;\nfunction isRetryableWriteError(error) {\n  return error.hasErrorLabel(exports.MongoErrorLabel.RetryableWriteError);\n}\nexports.isRetryableWriteError = isRetryableWriteError;\n/** Determines whether an error is something the driver should attempt to retry */\nfunction isRetryableReadError(error) {\n  const hasRetryableErrorCode = typeof error.code === 'number' ? RETRYABLE_READ_ERROR_CODES.has(error.code) : false;\n  if (hasRetryableErrorCode) {\n    return true;\n  }\n  if (error instanceof MongoNetworkError) {\n    return true;\n  }\n  const isNotWritablePrimaryError = exports.LEGACY_NOT_WRITABLE_PRIMARY_ERROR_MESSAGE.test(error.message);\n  if (isNotWritablePrimaryError) {\n    return true;\n  }\n  const isNodeIsRecoveringError = exports.NODE_IS_RECOVERING_ERROR_MESSAGE.test(error.message);\n  if (isNodeIsRecoveringError) {\n    return true;\n  }\n  return false;\n}\nexports.isRetryableReadError = isRetryableReadError;\nconst SDAM_RECOVERING_CODES = new Set([exports.MONGODB_ERROR_CODES.ShutdownInProgress, exports.MONGODB_ERROR_CODES.PrimarySteppedDown, exports.MONGODB_ERROR_CODES.InterruptedAtShutdown, exports.MONGODB_ERROR_CODES.InterruptedDueToReplStateChange, exports.MONGODB_ERROR_CODES.NotPrimaryOrSecondary]);\nconst SDAM_NOT_PRIMARY_CODES = new Set([exports.MONGODB_ERROR_CODES.NotWritablePrimary, exports.MONGODB_ERROR_CODES.NotPrimaryNoSecondaryOk, exports.MONGODB_ERROR_CODES.LegacyNotPrimary]);\nconst SDAM_NODE_SHUTTING_DOWN_ERROR_CODES = new Set([exports.MONGODB_ERROR_CODES.InterruptedAtShutdown, exports.MONGODB_ERROR_CODES.ShutdownInProgress]);\nfunction isRecoveringError(err) {\n  if (typeof err.code === 'number') {\n    // If any error code exists, we ignore the error.message\n    return SDAM_RECOVERING_CODES.has(err.code);\n  }\n  return exports.LEGACY_NOT_PRIMARY_OR_SECONDARY_ERROR_MESSAGE.test(err.message) || exports.NODE_IS_RECOVERING_ERROR_MESSAGE.test(err.message);\n}\nfunction isNotWritablePrimaryError(err) {\n  if (typeof err.code === 'number') {\n    // If any error code exists, we ignore the error.message\n    return SDAM_NOT_PRIMARY_CODES.has(err.code);\n  }\n  if (isRecoveringError(err)) {\n    return false;\n  }\n  return exports.LEGACY_NOT_WRITABLE_PRIMARY_ERROR_MESSAGE.test(err.message);\n}\nfunction isNodeShuttingDownError(err) {\n  return !!(typeof err.code === 'number' && SDAM_NODE_SHUTTING_DOWN_ERROR_CODES.has(err.code));\n}\nexports.isNodeShuttingDownError = isNodeShuttingDownError;\n/**\r\n * Determines whether SDAM can recover from a given error. If it cannot\r\n * then the pool will be cleared, and server state will completely reset\r\n * locally.\r\n *\r\n * @see https://github.com/mongodb/specifications/blob/master/source/server-discovery-and-monitoring/server-discovery-and-monitoring.rst#not-master-and-node-is-recovering\r\n */\nfunction isSDAMUnrecoverableError(error) {\n  // NOTE: null check is here for a strictly pre-CMAP world, a timeout or\n  //       close event are considered unrecoverable\n  if (error instanceof MongoParseError || error == null) {\n    return true;\n  }\n  return isRecoveringError(error) || isNotWritablePrimaryError(error);\n}\nexports.isSDAMUnrecoverableError = isSDAMUnrecoverableError;\nfunction isNetworkTimeoutError(err) {\n  return !!(err instanceof MongoNetworkError && err.message.match(/timed out/));\n}\nexports.isNetworkTimeoutError = isNetworkTimeoutError;\nfunction isResumableError(error, wireVersion) {\n  if (error == null || !(error instanceof MongoError)) {\n    return false;\n  }\n  if (error instanceof MongoNetworkError) {\n    return true;\n  }\n  if (wireVersion != null && wireVersion >= 9) {\n    // DRIVERS-1308: For 4.4 drivers running against 4.4 servers, drivers will add a special case to treat the CursorNotFound error code as resumable\n    if (error.code === exports.MONGODB_ERROR_CODES.CursorNotFound) {\n      return true;\n    }\n    return error.hasErrorLabel(exports.MongoErrorLabel.ResumableChangeStreamError);\n  }\n  if (typeof error.code === 'number') {\n    return exports.GET_MORE_RESUMABLE_CODES.has(error.code);\n  }\n  return false;\n}\nexports.isResumableError = isResumableError;","map":{"version":3,"mappings":"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","names":["kErrorLabels","Symbol","exports","RegExp","Object","freeze","HostUnreachable","HostNotFound","NetworkTimeout","ShutdownInProgress","PrimarySteppedDown","ExceededTimeLimit","SocketException","NotWritablePrimary","InterruptedAtShutdown","InterruptedDueToReplStateChange","NotPrimaryNoSecondaryOk","NotPrimaryOrSecondary","StaleShardVersion","StaleEpoch","StaleConfig","RetryChangeStream","FailedToSatisfyReadPreference","CursorNotFound","LegacyNotPrimary","WriteConcernFailed","NamespaceNotFound","IllegalOperation","MaxTimeMSExpired","UnknownReplWriteConcern","UnsatisfiableWriteConcern","Set","RetryableWriteError","TransientTransactionError","UnknownTransactionCommitResult","ResumableChangeStreamError","HandshakeError","ResetPool","NoWritesPerformed","MongoError","Error","constructor","message","cause","name","errmsg","hasErrorLabel","label","has","addErrorLabel","add","errorLabels","Array","from","MongoServerError","$err","MongoDriverError","MongoAPIError","MongoRuntimeError","MongoBatchReExecutionError","MongoDecompressionError","MongoNotConnectedError","MongoTransactionError","MongoExpiredSessionError","MongoKerberosError","MongoAWSError","MongoChangeStreamError","MongoTailableCursorError","MongoGridFSStreamError","MongoGridFSChunkError","MongoUnexpectedServerResponseError","MongoCursorInUseError","MongoServerClosedError","MongoCursorExhaustedError","MongoTopologyClosedError","kBeforeHandshake","isNetworkErrorBeforeHandshake","err","MongoNetworkError","options","beforeHandshake","MongoNetworkTimeoutError","MongoParseError","MongoInvalidArgumentError","MongoCompatibilityError","MongoMissingCredentialsError","MongoMissingDependencyError","MongoSystemError","reason","error","code","MongoServerSelectionError","makeWriteConcernResultObject","input","output","assign","ok","codeName","MongoWriteConcernError","result","isArray","errInfo","RETRYABLE_READ_ERROR_CODES","RETRYABLE_WRITE_ERROR_CODES","needsRetryableWriteLabel","maxWireVersion","isNotWritablePrimaryError","test","isNodeIsRecoveringError","isRetryableWriteError","isRetryableReadError","hasRetryableErrorCode","SDAM_RECOVERING_CODES","SDAM_NOT_PRIMARY_CODES","SDAM_NODE_SHUTTING_DOWN_ERROR_CODES","isRecoveringError","isNodeShuttingDownError","isSDAMUnrecoverableError","isNetworkTimeoutError","match","isResumableError","wireVersion"],"sources":["C:\\Users\\91930\\Desktop\\Github projects\\Pharmacy Demo\\back-end\\node_modules\\mongoose\\node_modules\\mongodb\\src\\error.ts"],"sourcesContent":["import type { Document } from './bson';\r\nimport type { TopologyVersion } from './sdam/server_description';\r\nimport type { TopologyDescription } from './sdam/topology_description';\r\n\r\n/** @public */\r\nexport type AnyError = MongoError | Error;\r\n\r\n/** @internal */\r\nconst kErrorLabels = Symbol('errorLabels');\r\n\r\n/**\r\n * @internal\r\n * The legacy error message from the server that indicates the node is not a writable primary\r\n * https://github.com/mongodb/specifications/blob/b07c26dc40d04ac20349f989db531c9845fdd755/source/server-discovery-and-monitoring/server-discovery-and-monitoring.rst#not-writable-primary-and-node-is-recovering\r\n */\r\nexport const LEGACY_NOT_WRITABLE_PRIMARY_ERROR_MESSAGE = new RegExp('not master', 'i');\r\n\r\n/**\r\n * @internal\r\n * The legacy error message from the server that indicates the node is not a primary or secondary\r\n * https://github.com/mongodb/specifications/blob/b07c26dc40d04ac20349f989db531c9845fdd755/source/server-discovery-and-monitoring/server-discovery-and-monitoring.rst#not-writable-primary-and-node-is-recovering\r\n */\r\nexport const LEGACY_NOT_PRIMARY_OR_SECONDARY_ERROR_MESSAGE = new RegExp(\r\n  'not master or secondary',\r\n  'i'\r\n);\r\n\r\n/**\r\n * @internal\r\n * The error message from the server that indicates the node is recovering\r\n * https://github.com/mongodb/specifications/blob/b07c26dc40d04ac20349f989db531c9845fdd755/source/server-discovery-and-monitoring/server-discovery-and-monitoring.rst#not-writable-primary-and-node-is-recovering\r\n */\r\nexport const NODE_IS_RECOVERING_ERROR_MESSAGE = new RegExp('node is recovering', 'i');\r\n\r\n/** @internal MongoDB Error Codes */\r\nexport const MONGODB_ERROR_CODES = Object.freeze({\r\n  HostUnreachable: 6,\r\n  HostNotFound: 7,\r\n  NetworkTimeout: 89,\r\n  ShutdownInProgress: 91,\r\n  PrimarySteppedDown: 189,\r\n  ExceededTimeLimit: 262,\r\n  SocketException: 9001,\r\n  NotWritablePrimary: 10107,\r\n  InterruptedAtShutdown: 11600,\r\n  InterruptedDueToReplStateChange: 11602,\r\n  NotPrimaryNoSecondaryOk: 13435,\r\n  NotPrimaryOrSecondary: 13436,\r\n  StaleShardVersion: 63,\r\n  StaleEpoch: 150,\r\n  StaleConfig: 13388,\r\n  RetryChangeStream: 234,\r\n  FailedToSatisfyReadPreference: 133,\r\n  CursorNotFound: 43,\r\n  LegacyNotPrimary: 10058,\r\n  WriteConcernFailed: 64,\r\n  NamespaceNotFound: 26,\r\n  IllegalOperation: 20,\r\n  MaxTimeMSExpired: 50,\r\n  UnknownReplWriteConcern: 79,\r\n  UnsatisfiableWriteConcern: 100\r\n} as const);\r\n\r\n// From spec@https://github.com/mongodb/specifications/blob/f93d78191f3db2898a59013a7ed5650352ef6da8/source/change-streams/change-streams.rst#resumable-error\r\nexport const GET_MORE_RESUMABLE_CODES = new Set<number>([\r\n  MONGODB_ERROR_CODES.HostUnreachable,\r\n  MONGODB_ERROR_CODES.HostNotFound,\r\n  MONGODB_ERROR_CODES.NetworkTimeout,\r\n  MONGODB_ERROR_CODES.ShutdownInProgress,\r\n  MONGODB_ERROR_CODES.PrimarySteppedDown,\r\n  MONGODB_ERROR_CODES.ExceededTimeLimit,\r\n  MONGODB_ERROR_CODES.SocketException,\r\n  MONGODB_ERROR_CODES.NotWritablePrimary,\r\n  MONGODB_ERROR_CODES.InterruptedAtShutdown,\r\n  MONGODB_ERROR_CODES.InterruptedDueToReplStateChange,\r\n  MONGODB_ERROR_CODES.NotPrimaryNoSecondaryOk,\r\n  MONGODB_ERROR_CODES.NotPrimaryOrSecondary,\r\n  MONGODB_ERROR_CODES.StaleShardVersion,\r\n  MONGODB_ERROR_CODES.StaleEpoch,\r\n  MONGODB_ERROR_CODES.StaleConfig,\r\n  MONGODB_ERROR_CODES.RetryChangeStream,\r\n  MONGODB_ERROR_CODES.FailedToSatisfyReadPreference,\r\n  MONGODB_ERROR_CODES.CursorNotFound\r\n]);\r\n\r\n/** @public */\r\nexport const MongoErrorLabel = Object.freeze({\r\n  RetryableWriteError: 'RetryableWriteError',\r\n  TransientTransactionError: 'TransientTransactionError',\r\n  UnknownTransactionCommitResult: 'UnknownTransactionCommitResult',\r\n  ResumableChangeStreamError: 'ResumableChangeStreamError',\r\n  HandshakeError: 'HandshakeError',\r\n  ResetPool: 'ResetPool',\r\n  NoWritesPerformed: 'NoWritesPerformed'\r\n} as const);\r\n\r\n/** @public */\r\nexport type MongoErrorLabel = typeof MongoErrorLabel[keyof typeof MongoErrorLabel];\r\n\r\n/** @public */\r\nexport interface ErrorDescription extends Document {\r\n  message?: string;\r\n  errmsg?: string;\r\n  $err?: string;\r\n  errorLabels?: string[];\r\n  errInfo?: Document;\r\n}\r\n\r\n/**\r\n * @public\r\n * @category Error\r\n *\r\n * @privateRemarks\r\n * mongodb-client-encryption has a dependency on this error, it uses the constructor with a string argument\r\n */\r\nexport class MongoError extends Error {\r\n  /** @internal */\r\n  [kErrorLabels]: Set<string>;\r\n  /**\r\n   * This is a number in MongoServerError and a string in MongoDriverError\r\n   * @privateRemarks\r\n   * Define the type override on the subclasses when we can use the override keyword\r\n   */\r\n  code?: number | string;\r\n  topologyVersion?: TopologyVersion;\r\n  connectionGeneration?: number;\r\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n  // @ts-ignore\r\n  cause?: Error; // depending on the node version, this may or may not exist on the base\r\n\r\n  constructor(message: string | Error) {\r\n    if (message instanceof Error) {\r\n      super(message.message);\r\n      this.cause = message;\r\n    } else {\r\n      super(message);\r\n    }\r\n    this[kErrorLabels] = new Set();\r\n  }\r\n\r\n  override get name(): string {\r\n    return 'MongoError';\r\n  }\r\n\r\n  /** Legacy name for server error responses */\r\n  get errmsg(): string {\r\n    return this.message;\r\n  }\r\n\r\n  /**\r\n   * Checks the error to see if it has an error label\r\n   *\r\n   * @param label - The error label to check for\r\n   * @returns returns true if the error has the provided error label\r\n   */\r\n  hasErrorLabel(label: string): boolean {\r\n    return this[kErrorLabels].has(label);\r\n  }\r\n\r\n  addErrorLabel(label: string): void {\r\n    this[kErrorLabels].add(label);\r\n  }\r\n\r\n  get errorLabels(): string[] {\r\n    return Array.from(this[kErrorLabels]);\r\n  }\r\n}\r\n\r\n/**\r\n * An error coming from the mongo server\r\n *\r\n * @public\r\n * @category Error\r\n */\r\nexport class MongoServerError extends MongoError {\r\n  codeName?: string;\r\n  writeConcernError?: Document;\r\n  errInfo?: Document;\r\n  ok?: number;\r\n  [key: string]: any;\r\n\r\n  constructor(message: ErrorDescription) {\r\n    super(message.message || message.errmsg || message.$err || 'n/a');\r\n    if (message.errorLabels) {\r\n      this[kErrorLabels] = new Set(message.errorLabels);\r\n    }\r\n\r\n    for (const name in message) {\r\n      if (name !== 'errorLabels' && name !== 'errmsg' && name !== 'message')\r\n        this[name] = message[name];\r\n    }\r\n  }\r\n\r\n  override get name(): string {\r\n    return 'MongoServerError';\r\n  }\r\n}\r\n\r\n/**\r\n * An error generated by the driver\r\n *\r\n * @public\r\n * @category Error\r\n */\r\nexport class MongoDriverError extends MongoError {\r\n  constructor(message: string) {\r\n    super(message);\r\n  }\r\n\r\n  override get name(): string {\r\n    return 'MongoDriverError';\r\n  }\r\n}\r\n\r\n/**\r\n * An error generated when the driver API is used incorrectly\r\n *\r\n * @privateRemarks\r\n * Should **never** be directly instantiated\r\n *\r\n * @public\r\n * @category Error\r\n */\r\n\r\nexport class MongoAPIError extends MongoDriverError {\r\n  constructor(message: string) {\r\n    super(message);\r\n  }\r\n\r\n  override get name(): string {\r\n    return 'MongoAPIError';\r\n  }\r\n}\r\n\r\n/**\r\n * An error generated when the driver encounters unexpected input\r\n * or reaches an unexpected/invalid internal state\r\n *\r\n * @privateRemarks\r\n * Should **never** be directly instantiated.\r\n *\r\n * @public\r\n * @category Error\r\n */\r\nexport class MongoRuntimeError extends MongoDriverError {\r\n  constructor(message: string) {\r\n    super(message);\r\n  }\r\n\r\n  override get name(): string {\r\n    return 'MongoRuntimeError';\r\n  }\r\n}\r\n\r\n/**\r\n * An error generated when a batch command is re-executed after one of the commands in the batch\r\n * has failed\r\n *\r\n * @public\r\n * @category Error\r\n */\r\nexport class MongoBatchReExecutionError extends MongoAPIError {\r\n  constructor(message = 'This batch has already been executed, create new batch to execute') {\r\n    super(message);\r\n  }\r\n\r\n  override get name(): string {\r\n    return 'MongoBatchReExecutionError';\r\n  }\r\n}\r\n\r\n/**\r\n * An error generated when the driver fails to decompress\r\n * data received from the server.\r\n *\r\n * @public\r\n * @category Error\r\n */\r\nexport class MongoDecompressionError extends MongoRuntimeError {\r\n  constructor(message: string) {\r\n    super(message);\r\n  }\r\n\r\n  override get name(): string {\r\n    return 'MongoDecompressionError';\r\n  }\r\n}\r\n\r\n/**\r\n * An error thrown when the user attempts to operate on a database or collection through a MongoClient\r\n * that has not yet successfully called the \"connect\" method\r\n *\r\n * @public\r\n * @category Error\r\n */\r\nexport class MongoNotConnectedError extends MongoAPIError {\r\n  constructor(message: string) {\r\n    super(message);\r\n  }\r\n\r\n  override get name(): string {\r\n    return 'MongoNotConnectedError';\r\n  }\r\n}\r\n\r\n/**\r\n * An error generated when the user makes a mistake in the usage of transactions.\r\n * (e.g. attempting to commit a transaction with a readPreference other than primary)\r\n *\r\n * @public\r\n * @category Error\r\n */\r\nexport class MongoTransactionError extends MongoAPIError {\r\n  constructor(message: string) {\r\n    super(message);\r\n  }\r\n\r\n  override get name(): string {\r\n    return 'MongoTransactionError';\r\n  }\r\n}\r\n\r\n/**\r\n * An error generated when the user attempts to operate\r\n * on a session that has expired or has been closed.\r\n *\r\n * @public\r\n * @category Error\r\n */\r\nexport class MongoExpiredSessionError extends MongoAPIError {\r\n  constructor(message = 'Cannot use a session that has ended') {\r\n    super(message);\r\n  }\r\n\r\n  override get name(): string {\r\n    return 'MongoExpiredSessionError';\r\n  }\r\n}\r\n\r\n/**\r\n * A error generated when the user attempts to authenticate\r\n * via Kerberos, but fails to connect to the Kerberos client.\r\n *\r\n * @public\r\n * @category Error\r\n */\r\nexport class MongoKerberosError extends MongoRuntimeError {\r\n  constructor(message: string) {\r\n    super(message);\r\n  }\r\n\r\n  override get name(): string {\r\n    return 'MongoKerberosError';\r\n  }\r\n}\r\n\r\n/**\r\n * A error generated when the user attempts to authenticate\r\n * via AWS, but fails\r\n *\r\n * @public\r\n * @category Error\r\n */\r\nexport class MongoAWSError extends MongoRuntimeError {\r\n  constructor(message: string) {\r\n    super(message);\r\n  }\r\n\r\n  override get name(): string {\r\n    return 'MongoAWSError';\r\n  }\r\n}\r\n\r\n/**\r\n * An error generated when a ChangeStream operation fails to execute.\r\n *\r\n * @public\r\n * @category Error\r\n */\r\nexport class MongoChangeStreamError extends MongoRuntimeError {\r\n  constructor(message: string) {\r\n    super(message);\r\n  }\r\n\r\n  override get name(): string {\r\n    return 'MongoChangeStreamError';\r\n  }\r\n}\r\n\r\n/**\r\n * An error thrown when the user calls a function or method not supported on a tailable cursor\r\n *\r\n * @public\r\n * @category Error\r\n */\r\nexport class MongoTailableCursorError extends MongoAPIError {\r\n  constructor(message = 'Tailable cursor does not support this operation') {\r\n    super(message);\r\n  }\r\n\r\n  override get name(): string {\r\n    return 'MongoTailableCursorError';\r\n  }\r\n}\r\n\r\n/** An error generated when a GridFSStream operation fails to execute.\r\n *\r\n * @public\r\n * @category Error\r\n */\r\nexport class MongoGridFSStreamError extends MongoRuntimeError {\r\n  constructor(message: string) {\r\n    super(message);\r\n  }\r\n\r\n  override get name(): string {\r\n    return 'MongoGridFSStreamError';\r\n  }\r\n}\r\n\r\n/**\r\n * An error generated when a malformed or invalid chunk is\r\n * encountered when reading from a GridFSStream.\r\n *\r\n * @public\r\n * @category Error\r\n */\r\nexport class MongoGridFSChunkError extends MongoRuntimeError {\r\n  constructor(message: string) {\r\n    super(message);\r\n  }\r\n\r\n  override get name(): string {\r\n    return 'MongoGridFSChunkError';\r\n  }\r\n}\r\n\r\n/**\r\n * An error generated when a **parsable** unexpected response comes from the server.\r\n * This is generally an error where the driver in a state expecting a certain behavior to occur in\r\n * the next message from MongoDB but it receives something else.\r\n * This error **does not** represent an issue with wire message formatting.\r\n *\r\n * #### Example\r\n * When an operation fails, it is the driver's job to retry it. It must perform serverSelection\r\n * again to make sure that it attempts the operation against a server in a good state. If server\r\n * selection returns a server that does not support retryable operations, this error is used.\r\n * This scenario is unlikely as retryable support would also have been determined on the first attempt\r\n * but it is possible the state change could report a selectable server that does not support retries.\r\n *\r\n * @public\r\n * @category Error\r\n */\r\nexport class MongoUnexpectedServerResponseError extends MongoRuntimeError {\r\n  constructor(message: string) {\r\n    super(message);\r\n  }\r\n\r\n  override get name(): string {\r\n    return 'MongoUnexpectedServerResponseError';\r\n  }\r\n}\r\n\r\n/**\r\n * An error thrown when the user attempts to add options to a cursor that has already been\r\n * initialized\r\n *\r\n * @public\r\n * @category Error\r\n */\r\nexport class MongoCursorInUseError extends MongoAPIError {\r\n  constructor(message = 'Cursor is already initialized') {\r\n    super(message);\r\n  }\r\n\r\n  override get name(): string {\r\n    return 'MongoCursorInUseError';\r\n  }\r\n}\r\n\r\n/**\r\n * An error generated when an attempt is made to operate\r\n * on a closed/closing server.\r\n *\r\n * @public\r\n * @category Error\r\n */\r\nexport class MongoServerClosedError extends MongoAPIError {\r\n  constructor(message = 'Server is closed') {\r\n    super(message);\r\n  }\r\n\r\n  override get name(): string {\r\n    return 'MongoServerClosedError';\r\n  }\r\n}\r\n\r\n/**\r\n * An error thrown when an attempt is made to read from a cursor that has been exhausted\r\n *\r\n * @public\r\n * @category Error\r\n */\r\nexport class MongoCursorExhaustedError extends MongoAPIError {\r\n  constructor(message?: string) {\r\n    super(message || 'Cursor is exhausted');\r\n  }\r\n\r\n  override get name(): string {\r\n    return 'MongoCursorExhaustedError';\r\n  }\r\n}\r\n\r\n/**\r\n * An error generated when an attempt is made to operate on a\r\n * dropped, or otherwise unavailable, database.\r\n *\r\n * @public\r\n * @category Error\r\n */\r\nexport class MongoTopologyClosedError extends MongoAPIError {\r\n  constructor(message = 'Topology is closed') {\r\n    super(message);\r\n  }\r\n\r\n  override get name(): string {\r\n    return 'MongoTopologyClosedError';\r\n  }\r\n}\r\n\r\n/** @internal */\r\nconst kBeforeHandshake = Symbol('beforeHandshake');\r\nexport function isNetworkErrorBeforeHandshake(err: MongoNetworkError): boolean {\r\n  return err[kBeforeHandshake] === true;\r\n}\r\n\r\n/** @public */\r\nexport interface MongoNetworkErrorOptions {\r\n  /** Indicates the timeout happened before a connection handshake completed */\r\n  beforeHandshake: boolean;\r\n}\r\n\r\n/**\r\n * An error indicating an issue with the network, including TCP errors and timeouts.\r\n * @public\r\n * @category Error\r\n */\r\nexport class MongoNetworkError extends MongoError {\r\n  /** @internal */\r\n  [kBeforeHandshake]?: boolean;\r\n\r\n  constructor(message: string | Error, options?: MongoNetworkErrorOptions) {\r\n    super(message);\r\n\r\n    if (options && typeof options.beforeHandshake === 'boolean') {\r\n      this[kBeforeHandshake] = options.beforeHandshake;\r\n    }\r\n  }\r\n\r\n  override get name(): string {\r\n    return 'MongoNetworkError';\r\n  }\r\n}\r\n\r\n/**\r\n * An error indicating a network timeout occurred\r\n * @public\r\n * @category Error\r\n *\r\n * @privateRemarks\r\n * mongodb-client-encryption has a dependency on this error with an instanceof check\r\n */\r\nexport class MongoNetworkTimeoutError extends MongoNetworkError {\r\n  constructor(message: string, options?: MongoNetworkErrorOptions) {\r\n    super(message, options);\r\n  }\r\n\r\n  override get name(): string {\r\n    return 'MongoNetworkTimeoutError';\r\n  }\r\n}\r\n\r\n/**\r\n * An error used when attempting to parse a value (like a connection string)\r\n * @public\r\n * @category Error\r\n */\r\nexport class MongoParseError extends MongoDriverError {\r\n  constructor(message: string) {\r\n    super(message);\r\n  }\r\n\r\n  override get name(): string {\r\n    return 'MongoParseError';\r\n  }\r\n}\r\n\r\n/**\r\n * An error generated when the user supplies malformed or unexpected arguments\r\n * or when a required argument or field is not provided.\r\n *\r\n *\r\n * @public\r\n * @category Error\r\n */\r\nexport class MongoInvalidArgumentError extends MongoAPIError {\r\n  constructor(message: string) {\r\n    super(message);\r\n  }\r\n\r\n  override get name(): string {\r\n    return 'MongoInvalidArgumentError';\r\n  }\r\n}\r\n\r\n/**\r\n * An error generated when a feature that is not enabled or allowed for the current server\r\n * configuration is used\r\n *\r\n *\r\n * @public\r\n * @category Error\r\n */\r\nexport class MongoCompatibilityError extends MongoAPIError {\r\n  constructor(message: string) {\r\n    super(message);\r\n  }\r\n\r\n  override get name(): string {\r\n    return 'MongoCompatibilityError';\r\n  }\r\n}\r\n\r\n/**\r\n * An error generated when the user fails to provide authentication credentials before attempting\r\n * to connect to a mongo server instance.\r\n *\r\n *\r\n * @public\r\n * @category Error\r\n */\r\nexport class MongoMissingCredentialsError extends MongoAPIError {\r\n  constructor(message: string) {\r\n    super(message);\r\n  }\r\n\r\n  override get name(): string {\r\n    return 'MongoMissingCredentialsError';\r\n  }\r\n}\r\n\r\n/**\r\n * An error generated when a required module or dependency is not present in the local environment\r\n *\r\n * @public\r\n * @category Error\r\n */\r\nexport class MongoMissingDependencyError extends MongoAPIError {\r\n  constructor(message: string) {\r\n    super(message);\r\n  }\r\n\r\n  override get name(): string {\r\n    return 'MongoMissingDependencyError';\r\n  }\r\n}\r\n/**\r\n * An error signifying a general system issue\r\n * @public\r\n * @category Error\r\n */\r\nexport class MongoSystemError extends MongoError {\r\n  /** An optional reason context, such as an error saved during flow of monitoring and selecting servers */\r\n  reason?: TopologyDescription;\r\n\r\n  constructor(message: string, reason: TopologyDescription) {\r\n    if (reason && reason.error) {\r\n      super(reason.error.message || reason.error);\r\n    } else {\r\n      super(message);\r\n    }\r\n\r\n    if (reason) {\r\n      this.reason = reason;\r\n    }\r\n\r\n    this.code = reason.error?.code;\r\n  }\r\n\r\n  override get name(): string {\r\n    return 'MongoSystemError';\r\n  }\r\n}\r\n\r\n/**\r\n * An error signifying a client-side server selection error\r\n * @public\r\n * @category Error\r\n */\r\nexport class MongoServerSelectionError extends MongoSystemError {\r\n  constructor(message: string, reason: TopologyDescription) {\r\n    super(message, reason);\r\n  }\r\n\r\n  override get name(): string {\r\n    return 'MongoServerSelectionError';\r\n  }\r\n}\r\n\r\nfunction makeWriteConcernResultObject(input: any) {\r\n  const output = Object.assign({}, input);\r\n\r\n  if (output.ok === 0) {\r\n    output.ok = 1;\r\n    delete output.errmsg;\r\n    delete output.code;\r\n    delete output.codeName;\r\n  }\r\n\r\n  return output;\r\n}\r\n\r\n/**\r\n * An error thrown when the server reports a writeConcernError\r\n * @public\r\n * @category Error\r\n */\r\nexport class MongoWriteConcernError extends MongoServerError {\r\n  /** The result document (provided if ok: 1) */\r\n  result?: Document;\r\n\r\n  constructor(message: ErrorDescription, result?: Document) {\r\n    if (result && Array.isArray(result.errorLabels)) {\r\n      message.errorLabels = result.errorLabels;\r\n    }\r\n\r\n    super(message);\r\n    this.errInfo = message.errInfo;\r\n\r\n    if (result != null) {\r\n      this.result = makeWriteConcernResultObject(result);\r\n    }\r\n  }\r\n\r\n  override get name(): string {\r\n    return 'MongoWriteConcernError';\r\n  }\r\n}\r\n\r\n// https://github.com/mongodb/specifications/blob/master/source/retryable-reads/retryable-reads.rst#retryable-error\r\nconst RETRYABLE_READ_ERROR_CODES = new Set<number>([\r\n  MONGODB_ERROR_CODES.HostUnreachable,\r\n  MONGODB_ERROR_CODES.HostNotFound,\r\n  MONGODB_ERROR_CODES.NetworkTimeout,\r\n  MONGODB_ERROR_CODES.ShutdownInProgress,\r\n  MONGODB_ERROR_CODES.PrimarySteppedDown,\r\n  MONGODB_ERROR_CODES.SocketException,\r\n  MONGODB_ERROR_CODES.NotWritablePrimary,\r\n  MONGODB_ERROR_CODES.InterruptedAtShutdown,\r\n  MONGODB_ERROR_CODES.InterruptedDueToReplStateChange,\r\n  MONGODB_ERROR_CODES.NotPrimaryNoSecondaryOk,\r\n  MONGODB_ERROR_CODES.NotPrimaryOrSecondary\r\n]);\r\n\r\n// see: https://github.com/mongodb/specifications/blob/master/source/retryable-writes/retryable-writes.rst#terms\r\nconst RETRYABLE_WRITE_ERROR_CODES = new Set<number>([\r\n  ...RETRYABLE_READ_ERROR_CODES,\r\n  MONGODB_ERROR_CODES.ExceededTimeLimit\r\n]);\r\n\r\nexport function needsRetryableWriteLabel(error: Error, maxWireVersion: number): boolean {\r\n  // pre-4.4 server, then the driver adds an error label for every valid case\r\n  // execute operation will only inspect the label, code/message logic is handled here\r\n  if (error instanceof MongoNetworkError) {\r\n    return true;\r\n  }\r\n\r\n  if (error instanceof MongoError) {\r\n    if (\r\n      (maxWireVersion >= 9 || error.hasErrorLabel(MongoErrorLabel.RetryableWriteError)) &&\r\n      !error.hasErrorLabel(MongoErrorLabel.HandshakeError)\r\n    ) {\r\n      // If we already have the error label no need to add it again. 4.4+ servers add the label.\r\n      // In the case where we have a handshake error, need to fall down to the logic checking\r\n      // the codes.\r\n      return false;\r\n    }\r\n  }\r\n\r\n  if (error instanceof MongoWriteConcernError) {\r\n    return RETRYABLE_WRITE_ERROR_CODES.has(error.result?.code ?? error.code ?? 0);\r\n  }\r\n\r\n  if (error instanceof MongoError && typeof error.code === 'number') {\r\n    return RETRYABLE_WRITE_ERROR_CODES.has(error.code);\r\n  }\r\n\r\n  const isNotWritablePrimaryError = LEGACY_NOT_WRITABLE_PRIMARY_ERROR_MESSAGE.test(error.message);\r\n  if (isNotWritablePrimaryError) {\r\n    return true;\r\n  }\r\n\r\n  const isNodeIsRecoveringError = NODE_IS_RECOVERING_ERROR_MESSAGE.test(error.message);\r\n  if (isNodeIsRecoveringError) {\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nexport function isRetryableWriteError(error: MongoError): boolean {\r\n  return error.hasErrorLabel(MongoErrorLabel.RetryableWriteError);\r\n}\r\n\r\n/** Determines whether an error is something the driver should attempt to retry */\r\nexport function isRetryableReadError(error: MongoError): boolean {\r\n  const hasRetryableErrorCode =\r\n    typeof error.code === 'number' ? RETRYABLE_READ_ERROR_CODES.has(error.code) : false;\r\n  if (hasRetryableErrorCode) {\r\n    return true;\r\n  }\r\n\r\n  if (error instanceof MongoNetworkError) {\r\n    return true;\r\n  }\r\n\r\n  const isNotWritablePrimaryError = LEGACY_NOT_WRITABLE_PRIMARY_ERROR_MESSAGE.test(error.message);\r\n  if (isNotWritablePrimaryError) {\r\n    return true;\r\n  }\r\n\r\n  const isNodeIsRecoveringError = NODE_IS_RECOVERING_ERROR_MESSAGE.test(error.message);\r\n  if (isNodeIsRecoveringError) {\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nconst SDAM_RECOVERING_CODES = new Set<number>([\r\n  MONGODB_ERROR_CODES.ShutdownInProgress,\r\n  MONGODB_ERROR_CODES.PrimarySteppedDown,\r\n  MONGODB_ERROR_CODES.InterruptedAtShutdown,\r\n  MONGODB_ERROR_CODES.InterruptedDueToReplStateChange,\r\n  MONGODB_ERROR_CODES.NotPrimaryOrSecondary\r\n]);\r\n\r\nconst SDAM_NOT_PRIMARY_CODES = new Set<number>([\r\n  MONGODB_ERROR_CODES.NotWritablePrimary,\r\n  MONGODB_ERROR_CODES.NotPrimaryNoSecondaryOk,\r\n  MONGODB_ERROR_CODES.LegacyNotPrimary\r\n]);\r\n\r\nconst SDAM_NODE_SHUTTING_DOWN_ERROR_CODES = new Set<number>([\r\n  MONGODB_ERROR_CODES.InterruptedAtShutdown,\r\n  MONGODB_ERROR_CODES.ShutdownInProgress\r\n]);\r\n\r\nfunction isRecoveringError(err: MongoError) {\r\n  if (typeof err.code === 'number') {\r\n    // If any error code exists, we ignore the error.message\r\n    return SDAM_RECOVERING_CODES.has(err.code);\r\n  }\r\n\r\n  return (\r\n    LEGACY_NOT_PRIMARY_OR_SECONDARY_ERROR_MESSAGE.test(err.message) ||\r\n    NODE_IS_RECOVERING_ERROR_MESSAGE.test(err.message)\r\n  );\r\n}\r\n\r\nfunction isNotWritablePrimaryError(err: MongoError) {\r\n  if (typeof err.code === 'number') {\r\n    // If any error code exists, we ignore the error.message\r\n    return SDAM_NOT_PRIMARY_CODES.has(err.code);\r\n  }\r\n\r\n  if (isRecoveringError(err)) {\r\n    return false;\r\n  }\r\n\r\n  return LEGACY_NOT_WRITABLE_PRIMARY_ERROR_MESSAGE.test(err.message);\r\n}\r\n\r\nexport function isNodeShuttingDownError(err: MongoError): boolean {\r\n  return !!(typeof err.code === 'number' && SDAM_NODE_SHUTTING_DOWN_ERROR_CODES.has(err.code));\r\n}\r\n\r\n/**\r\n * Determines whether SDAM can recover from a given error. If it cannot\r\n * then the pool will be cleared, and server state will completely reset\r\n * locally.\r\n *\r\n * @see https://github.com/mongodb/specifications/blob/master/source/server-discovery-and-monitoring/server-discovery-and-monitoring.rst#not-master-and-node-is-recovering\r\n */\r\nexport function isSDAMUnrecoverableError(error: MongoError): boolean {\r\n  // NOTE: null check is here for a strictly pre-CMAP world, a timeout or\r\n  //       close event are considered unrecoverable\r\n  if (error instanceof MongoParseError || error == null) {\r\n    return true;\r\n  }\r\n\r\n  return isRecoveringError(error) || isNotWritablePrimaryError(error);\r\n}\r\n\r\nexport function isNetworkTimeoutError(err: MongoError): err is MongoNetworkError {\r\n  return !!(err instanceof MongoNetworkError && err.message.match(/timed out/));\r\n}\r\n\r\nexport function isResumableError(error?: Error, wireVersion?: number): boolean {\r\n  if (error == null || !(error instanceof MongoError)) {\r\n    return false;\r\n  }\r\n\r\n  if (error instanceof MongoNetworkError) {\r\n    return true;\r\n  }\r\n\r\n  if (wireVersion != null && wireVersion >= 9) {\r\n    // DRIVERS-1308: For 4.4 drivers running against 4.4 servers, drivers will add a special case to treat the CursorNotFound error code as resumable\r\n    if (error.code === MONGODB_ERROR_CODES.CursorNotFound) {\r\n      return true;\r\n    }\r\n    return error.hasErrorLabel(MongoErrorLabel.ResumableChangeStreamError);\r\n  }\r\n\r\n  if (typeof error.code === 'number') {\r\n    return GET_MORE_RESUMABLE_CODES.has(error.code);\r\n  }\r\n\r\n  return false;\r\n}\r\n"]},"metadata":{},"sourceType":"script","externalDependencies":[]}