{"ast":null,"code":"'use strict';\n\n/*!\r\n * Module dependencies.\r\n */\nconst ArrayType = require('./array');\nconst CastError = require('../error/cast');\nconst EventEmitter = require('events').EventEmitter;\nconst SchemaDocumentArrayOptions = require('../options/SchemaDocumentArrayOptions');\nconst SchemaType = require('../schematype');\nconst SubdocumentPath = require('./SubdocumentPath');\nconst discriminator = require('../helpers/model/discriminator');\nconst handleIdOption = require('../helpers/schema/handleIdOption');\nconst handleSpreadDoc = require('../helpers/document/handleSpreadDoc');\nconst utils = require('../utils');\nconst getConstructor = require('../helpers/discriminator/getConstructor');\nconst arrayAtomicsSymbol = require('../helpers/symbols').arrayAtomicsSymbol;\nconst arrayPathSymbol = require('../helpers/symbols').arrayPathSymbol;\nconst documentArrayParent = require('../helpers/symbols').documentArrayParent;\nlet MongooseDocumentArray;\nlet Subdocument;\n\n/**\r\n * SubdocsArray SchemaType constructor\r\n *\r\n * @param {String} key\r\n * @param {Schema} schema\r\n * @param {Object} options\r\n * @param {Object} schemaOptions\r\n * @inherits SchemaArray\r\n * @api public\r\n */\n\nfunction DocumentArrayPath(key, schema, options, schemaOptions) {\n  const schemaTypeIdOption = DocumentArrayPath.defaultOptions && DocumentArrayPath.defaultOptions._id;\n  if (schemaTypeIdOption != null) {\n    schemaOptions = schemaOptions || {};\n    schemaOptions._id = schemaTypeIdOption;\n  }\n  if (schemaOptions != null && schemaOptions._id != null) {\n    schema = handleIdOption(schema, schemaOptions);\n  } else if (options != null && options._id != null) {\n    schema = handleIdOption(schema, options);\n  }\n  const EmbeddedDocument = _createConstructor(schema, options);\n  EmbeddedDocument.prototype.$basePath = key;\n  ArrayType.call(this, key, EmbeddedDocument, options);\n  this.schema = schema;\n  this.schemaOptions = schemaOptions || {};\n  this.$isMongooseDocumentArray = true;\n  this.Constructor = EmbeddedDocument;\n  EmbeddedDocument.base = schema.base;\n  const fn = this.defaultValue;\n  if (!('defaultValue' in this) || fn !== void 0) {\n    this.default(function () {\n      let arr = fn.call(this);\n      if (arr != null && !Array.isArray(arr)) {\n        arr = [arr];\n      }\n      // Leave it up to `cast()` to convert this to a documentarray\n      return arr;\n    });\n  }\n  const parentSchemaType = this;\n  this.$embeddedSchemaType = new SchemaType(key + '.$', {\n    required: this && this.schemaOptions && this.schemaOptions.required || false\n  });\n  this.$embeddedSchemaType.cast = function (value, doc, init) {\n    return parentSchemaType.cast(value, doc, init)[0];\n  };\n  this.$embeddedSchemaType.doValidate = function (value, fn, scope, options) {\n    const Constructor = getConstructor(this.caster, value);\n    if (value && !(value instanceof Constructor)) {\n      value = new Constructor(value, scope, null, null, options && options.index != null ? options.index : null);\n    }\n    return SubdocumentPath.prototype.doValidate.call(this, value, fn, scope, options);\n  };\n  this.$embeddedSchemaType.$isMongooseDocumentArrayElement = true;\n  this.$embeddedSchemaType.caster = this.Constructor;\n  this.$embeddedSchemaType.schema = this.schema;\n}\n\n/**\r\n * This schema type's name, to defend against minifiers that mangle\r\n * function names.\r\n *\r\n * @api public\r\n */\nDocumentArrayPath.schemaName = 'DocumentArray';\n\n/**\r\n * Options for all document arrays.\r\n *\r\n * - `castNonArrays`: `true` by default. If `false`, Mongoose will throw a CastError when a value isn't an array. If `true`, Mongoose will wrap the provided value in an array before casting.\r\n *\r\n * @api public\r\n */\n\nDocumentArrayPath.options = {\n  castNonArrays: true\n};\n\n/*!\r\n * Inherits from ArrayType.\r\n */\nDocumentArrayPath.prototype = Object.create(ArrayType.prototype);\nDocumentArrayPath.prototype.constructor = DocumentArrayPath;\nDocumentArrayPath.prototype.OptionsConstructor = SchemaDocumentArrayOptions;\n\n/*!\r\n * ignore\r\n */\n\nfunction _createConstructor(schema, options, baseClass) {\n  Subdocument || (Subdocument = require('../types/ArraySubdocument'));\n\n  // compile an embedded document for this schema\n  function EmbeddedDocument() {\n    Subdocument.apply(this, arguments);\n    if (this.__parentArray == null || this.__parentArray.getArrayParent() == null) {\n      return;\n    }\n    this.$session(this.__parentArray.getArrayParent().$session());\n  }\n  schema._preCompile();\n  const proto = baseClass != null ? baseClass.prototype : Subdocument.prototype;\n  EmbeddedDocument.prototype = Object.create(proto);\n  EmbeddedDocument.prototype.$__setSchema(schema);\n  EmbeddedDocument.schema = schema;\n  EmbeddedDocument.prototype.constructor = EmbeddedDocument;\n  EmbeddedDocument.$isArraySubdocument = true;\n  EmbeddedDocument.events = new EventEmitter();\n  EmbeddedDocument.base = schema.base;\n\n  // apply methods\n  for (const i in schema.methods) {\n    EmbeddedDocument.prototype[i] = schema.methods[i];\n  }\n\n  // apply statics\n  for (const i in schema.statics) {\n    EmbeddedDocument[i] = schema.statics[i];\n  }\n  for (const i in EventEmitter.prototype) {\n    EmbeddedDocument[i] = EventEmitter.prototype[i];\n  }\n  EmbeddedDocument.options = options;\n  return EmbeddedDocument;\n}\n\n/**\r\n * Adds a discriminator to this document array.\r\n *\r\n * #### Example:\r\n *\r\n *     const shapeSchema = Schema({ name: String }, { discriminatorKey: 'kind' });\r\n *     const schema = Schema({ shapes: [shapeSchema] });\r\n *\r\n *     const docArrayPath = parentSchema.path('shapes');\r\n *     docArrayPath.discriminator('Circle', Schema({ radius: Number }));\r\n *\r\n * @param {String} name\r\n * @param {Schema} schema fields to add to the schema for instances of this sub-class\r\n * @param {Object|string} [options] If string, same as `options.value`.\r\n * @param {String} [options.value] the string stored in the `discriminatorKey` property. If not specified, Mongoose uses the `name` parameter.\r\n * @param {Boolean} [options.clone=true] By default, `discriminator()` clones the given `schema`. Set to `false` to skip cloning.\r\n * @see discriminators /docs/discriminators.html\r\n * @return {Function} the constructor Mongoose will use for creating instances of this discriminator model\r\n * @api public\r\n */\n\nDocumentArrayPath.prototype.discriminator = function (name, schema, options) {\n  if (typeof name === 'function') {\n    name = utils.getFunctionName(name);\n  }\n  options = options || {};\n  const tiedValue = utils.isPOJO(options) ? options.value : options;\n  const clone = typeof options.clone === 'boolean' ? options.clone : true;\n  if (schema.instanceOfSchema && clone) {\n    schema = schema.clone();\n  }\n  schema = discriminator(this.casterConstructor, name, schema, tiedValue);\n  const EmbeddedDocument = _createConstructor(schema, null, this.casterConstructor);\n  EmbeddedDocument.baseCasterConstructor = this.casterConstructor;\n  try {\n    Object.defineProperty(EmbeddedDocument, 'name', {\n      value: name\n    });\n  } catch (error) {\n    // Ignore error, only happens on old versions of node\n  }\n  this.casterConstructor.discriminators[name] = EmbeddedDocument;\n  return this.casterConstructor.discriminators[name];\n};\n\n/**\r\n * Performs local validations first, then validations on each embedded doc\r\n *\r\n * @api private\r\n */\n\nDocumentArrayPath.prototype.doValidate = function (array, fn, scope, options) {\n  // lazy load\n  MongooseDocumentArray || (MongooseDocumentArray = require('../types/DocumentArray'));\n  const _this = this;\n  try {\n    SchemaType.prototype.doValidate.call(this, array, cb, scope);\n  } catch (err) {\n    return fn(err);\n  }\n  function cb(err) {\n    if (err) {\n      return fn(err);\n    }\n    let count = array && array.length;\n    let error;\n    if (!count) {\n      return fn();\n    }\n    if (options && options.updateValidator) {\n      return fn();\n    }\n    if (!utils.isMongooseDocumentArray(array)) {\n      array = new MongooseDocumentArray(array, _this.path, scope);\n    }\n\n    // handle sparse arrays, do not use array.forEach which does not\n    // iterate over sparse elements yet reports array.length including\n    // them :(\n\n    function callback(err) {\n      if (err != null) {\n        error = err;\n      }\n      --count || fn(error);\n    }\n    for (let i = 0, len = count; i < len; ++i) {\n      // sidestep sparse entries\n      let doc = array[i];\n      if (doc == null) {\n        --count || fn(error);\n        continue;\n      }\n\n      // If you set the array index directly, the doc might not yet be\n      // a full fledged mongoose subdoc, so make it into one.\n      if (!(doc instanceof Subdocument)) {\n        const Constructor = getConstructor(_this.casterConstructor, array[i]);\n        doc = array[i] = new Constructor(doc, array, undefined, undefined, i);\n      }\n      if (options != null && options.validateModifiedOnly && !doc.$isModified()) {\n        --count || fn(error);\n        continue;\n      }\n      doc.$__validate(callback);\n    }\n  }\n};\n\n/**\r\n * Performs local validations first, then validations on each embedded doc.\r\n *\r\n * #### Note:\r\n *\r\n * This method ignores the asynchronous validators.\r\n *\r\n * @return {MongooseError|undefined}\r\n * @api private\r\n */\n\nDocumentArrayPath.prototype.doValidateSync = function (array, scope, options) {\n  const schemaTypeError = SchemaType.prototype.doValidateSync.call(this, array, scope);\n  if (schemaTypeError != null) {\n    return schemaTypeError;\n  }\n  const count = array && array.length;\n  let resultError = null;\n  if (!count) {\n    return;\n  }\n\n  // handle sparse arrays, do not use array.forEach which does not\n  // iterate over sparse elements yet reports array.length including\n  // them :(\n\n  for (let i = 0, len = count; i < len; ++i) {\n    // sidestep sparse entries\n    let doc = array[i];\n    if (!doc) {\n      continue;\n    }\n\n    // If you set the array index directly, the doc might not yet be\n    // a full fledged mongoose subdoc, so make it into one.\n    if (!(doc instanceof Subdocument)) {\n      const Constructor = getConstructor(this.casterConstructor, array[i]);\n      doc = array[i] = new Constructor(doc, array, undefined, undefined, i);\n    }\n    if (options != null && options.validateModifiedOnly && !doc.$isModified()) {\n      continue;\n    }\n    const subdocValidateError = doc.validateSync();\n    if (subdocValidateError && resultError == null) {\n      resultError = subdocValidateError;\n    }\n  }\n  return resultError;\n};\n\n/*!\r\n * ignore\r\n */\n\nDocumentArrayPath.prototype.getDefault = function (scope, init, options) {\n  let ret = typeof this.defaultValue === 'function' ? this.defaultValue.call(scope) : this.defaultValue;\n  if (ret == null) {\n    return ret;\n  }\n  if (options && options.skipCast) {\n    return ret;\n  }\n\n  // lazy load\n  MongooseDocumentArray || (MongooseDocumentArray = require('../types/DocumentArray'));\n  if (!Array.isArray(ret)) {\n    ret = [ret];\n  }\n  ret = new MongooseDocumentArray(ret, this.path, scope);\n  for (let i = 0; i < ret.length; ++i) {\n    const Constructor = getConstructor(this.casterConstructor, ret[i]);\n    const _subdoc = new Constructor({}, ret, undefined, undefined, i);\n    _subdoc.$init(ret[i]);\n    _subdoc.isNew = true;\n\n    // Make sure all paths in the subdoc are set to `default` instead\n    // of `init` since we used `init`.\n    Object.assign(_subdoc.$__.activePaths.default, _subdoc.$__.activePaths.init);\n    _subdoc.$__.activePaths.init = {};\n    ret[i] = _subdoc;\n  }\n  return ret;\n};\nconst _toObjectOptions = Object.freeze({\n  transform: false,\n  virtuals: false\n});\nconst initDocumentOptions = Object.freeze({\n  skipId: false,\n  willInit: true\n});\n\n/**\r\n * Casts contents\r\n *\r\n * @param {Object} value\r\n * @param {Document} document that triggers the casting\r\n * @api private\r\n */\n\nDocumentArrayPath.prototype.cast = function (value, doc, init, prev, options) {\n  // lazy load\n  MongooseDocumentArray || (MongooseDocumentArray = require('../types/DocumentArray'));\n\n  // Skip casting if `value` is the same as the previous value, no need to cast. See gh-9266\n  if (value != null && value[arrayPathSymbol] != null && value === prev) {\n    return value;\n  }\n  let selected;\n  let subdoc;\n  options = options || {};\n  if (!Array.isArray(value)) {\n    if (!init && !DocumentArrayPath.options.castNonArrays) {\n      throw new CastError('DocumentArray', value, this.path, null, this);\n    }\n    // gh-2442 mark whole array as modified if we're initializing a doc from\n    // the db and the path isn't an array in the document\n    if (!!doc && init) {\n      doc.markModified(this.path);\n    }\n    return this.cast([value], doc, init, prev, options);\n  }\n\n  // We need to create a new array, otherwise change tracking will\n  // update the old doc (gh-4449)\n  if (!options.skipDocumentArrayCast || utils.isMongooseDocumentArray(value)) {\n    value = new MongooseDocumentArray(value, this.path, doc);\n  }\n  if (prev != null) {\n    value[arrayAtomicsSymbol] = prev[arrayAtomicsSymbol] || {};\n  }\n  if (options.arrayPathIndex != null) {\n    value[arrayPathSymbol] = this.path + '.' + options.arrayPathIndex;\n  }\n  const rawArray = utils.isMongooseDocumentArray(value) ? value.__array : value;\n  const len = rawArray.length;\n  for (let i = 0; i < len; ++i) {\n    if (!rawArray[i]) {\n      continue;\n    }\n    const Constructor = getConstructor(this.casterConstructor, rawArray[i]);\n\n    // Check if the document has a different schema (re gh-3701)\n    if (rawArray[i].$__ != null && !(rawArray[i] instanceof Constructor)) {\n      const spreadDoc = handleSpreadDoc(rawArray[i], true);\n      if (rawArray[i] !== spreadDoc) {\n        rawArray[i] = spreadDoc;\n      } else {\n        rawArray[i] = rawArray[i].toObject({\n          transform: false,\n          // Special case: if different model, but same schema, apply virtuals\n          // re: gh-7898\n          virtuals: rawArray[i].schema === Constructor.schema\n        });\n      }\n    }\n    if (rawArray[i] instanceof Subdocument) {\n      if (rawArray[i][documentArrayParent] !== doc) {\n        if (init) {\n          const subdoc = new Constructor(null, value, initDocumentOptions, selected, i);\n          rawArray[i] = subdoc.$init(rawArray[i]);\n        } else {\n          const subdoc = new Constructor(rawArray[i], value, undefined, undefined, i);\n          rawArray[i] = subdoc;\n        }\n      }\n      // Might not have the correct index yet, so ensure it does.\n      if (rawArray[i].__index == null) {\n        rawArray[i].$setIndex(i);\n      }\n    } else if (rawArray[i] != null) {\n      if (init) {\n        if (doc) {\n          selected || (selected = scopePaths(this, doc.$__.selected, init));\n        } else {\n          selected = true;\n        }\n        subdoc = new Constructor(null, value, initDocumentOptions, selected, i);\n        rawArray[i] = subdoc.$init(rawArray[i]);\n      } else {\n        if (prev && typeof prev.id === 'function') {\n          subdoc = prev.id(rawArray[i]._id);\n        }\n        if (prev && subdoc && utils.deepEqual(subdoc.toObject(_toObjectOptions), rawArray[i])) {\n          // handle resetting doc with existing id and same data\n          subdoc.set(rawArray[i]);\n          // if set() is hooked it will have no return value\n          // see gh-746\n          rawArray[i] = subdoc;\n        } else {\n          try {\n            subdoc = new Constructor(rawArray[i], value, undefined, undefined, i);\n            // if set() is hooked it will have no return value\n            // see gh-746\n            rawArray[i] = subdoc;\n          } catch (error) {\n            throw new CastError('embedded', rawArray[i], value[arrayPathSymbol], error, this);\n          }\n        }\n      }\n    }\n  }\n  return value;\n};\n\n/*!\r\n * ignore\r\n */\n\nDocumentArrayPath.prototype.clone = function () {\n  const options = Object.assign({}, this.options);\n  const schematype = new this.constructor(this.path, this.schema, options, this.schemaOptions);\n  schematype.validators = this.validators.slice();\n  if (this.requiredValidator !== undefined) {\n    schematype.requiredValidator = this.requiredValidator;\n  }\n  schematype.Constructor.discriminators = Object.assign({}, this.Constructor.discriminators);\n  return schematype;\n};\n\n/*!\r\n * ignore\r\n */\n\nDocumentArrayPath.prototype.applyGetters = function (value, scope) {\n  return SchemaType.prototype.applyGetters.call(this, value, scope);\n};\n\n/**\r\n * Scopes paths selected in a query to this array.\r\n * Necessary for proper default application of subdocument values.\r\n *\r\n * @param {DocumentArrayPath} array the array to scope `fields` paths\r\n * @param {Object|undefined} fields the root fields selected in the query\r\n * @param {Boolean|undefined} init if we are being created part of a query result\r\n * @api private\r\n */\n\nfunction scopePaths(array, fields, init) {\n  if (!(init && fields)) {\n    return undefined;\n  }\n  const path = array.path + '.';\n  const keys = Object.keys(fields);\n  let i = keys.length;\n  const selected = {};\n  let hasKeys;\n  let key;\n  let sub;\n  while (i--) {\n    key = keys[i];\n    if (key.startsWith(path)) {\n      sub = key.substring(path.length);\n      if (sub === '$') {\n        continue;\n      }\n      if (sub.startsWith('$.')) {\n        sub = sub.substring(2);\n      }\n      hasKeys || (hasKeys = true);\n      selected[sub] = fields[key];\n    }\n  }\n  return hasKeys && selected || undefined;\n}\n\n/*!\r\n * ignore\r\n */\n\nDocumentArrayPath.defaultOptions = {};\n\n/**\r\n * Sets a default option for all DocumentArray instances.\r\n *\r\n * #### Example:\r\n *\r\n *     // Make all numbers have option `min` equal to 0.\r\n *     mongoose.Schema.DocumentArray.set('_id', false);\r\n *\r\n * @param {String} option The name of the option you'd like to set (e.g. trim, lowercase, etc...)\r\n * @param {Any} value The value of the option you'd like to set.\r\n * @return {void}\r\n * @function set\r\n * @static\r\n * @api public\r\n */\n\nDocumentArrayPath.set = SchemaType.set;\n\n/*!\r\n * Module exports.\r\n */\n\nmodule.exports = DocumentArrayPath;","map":{"version":3,"names":["ArrayType","require","CastError","EventEmitter","SchemaDocumentArrayOptions","SchemaType","SubdocumentPath","discriminator","handleIdOption","handleSpreadDoc","utils","getConstructor","arrayAtomicsSymbol","arrayPathSymbol","documentArrayParent","MongooseDocumentArray","Subdocument","DocumentArrayPath","key","schema","options","schemaOptions","schemaTypeIdOption","defaultOptions","_id","EmbeddedDocument","_createConstructor","prototype","$basePath","call","$isMongooseDocumentArray","Constructor","base","fn","defaultValue","default","arr","Array","isArray","parentSchemaType","$embeddedSchemaType","required","cast","value","doc","init","doValidate","scope","caster","index","$isMongooseDocumentArrayElement","schemaName","castNonArrays","Object","create","constructor","OptionsConstructor","baseClass","apply","arguments","__parentArray","getArrayParent","$session","_preCompile","proto","$__setSchema","$isArraySubdocument","events","i","methods","statics","name","getFunctionName","tiedValue","isPOJO","clone","instanceOfSchema","casterConstructor","baseCasterConstructor","defineProperty","error","discriminators","array","_this","cb","err","count","length","updateValidator","isMongooseDocumentArray","path","callback","len","undefined","validateModifiedOnly","$isModified","$__validate","doValidateSync","schemaTypeError","resultError","subdocValidateError","validateSync","getDefault","ret","skipCast","_subdoc","$init","isNew","assign","$__","activePaths","_toObjectOptions","freeze","transform","virtuals","initDocumentOptions","skipId","willInit","prev","selected","subdoc","markModified","skipDocumentArrayCast","arrayPathIndex","rawArray","__array","spreadDoc","toObject","__index","$setIndex","scopePaths","id","deepEqual","set","schematype","validators","slice","requiredValidator","applyGetters","fields","keys","hasKeys","sub","startsWith","substring","module","exports"],"sources":["C:/Users/91930/Desktop/Github projects/Pharmacy Demo/back-end/node_modules/mongoose/lib/schema/documentarray.js"],"sourcesContent":["'use strict';\r\n\r\n/*!\r\n * Module dependencies.\r\n */\r\n\r\nconst ArrayType = require('./array');\r\nconst CastError = require('../error/cast');\r\nconst EventEmitter = require('events').EventEmitter;\r\nconst SchemaDocumentArrayOptions =\r\n  require('../options/SchemaDocumentArrayOptions');\r\nconst SchemaType = require('../schematype');\r\nconst SubdocumentPath = require('./SubdocumentPath');\r\nconst discriminator = require('../helpers/model/discriminator');\r\nconst handleIdOption = require('../helpers/schema/handleIdOption');\r\nconst handleSpreadDoc = require('../helpers/document/handleSpreadDoc');\r\nconst utils = require('../utils');\r\nconst getConstructor = require('../helpers/discriminator/getConstructor');\r\n\r\nconst arrayAtomicsSymbol = require('../helpers/symbols').arrayAtomicsSymbol;\r\nconst arrayPathSymbol = require('../helpers/symbols').arrayPathSymbol;\r\nconst documentArrayParent = require('../helpers/symbols').documentArrayParent;\r\n\r\nlet MongooseDocumentArray;\r\nlet Subdocument;\r\n\r\n/**\r\n * SubdocsArray SchemaType constructor\r\n *\r\n * @param {String} key\r\n * @param {Schema} schema\r\n * @param {Object} options\r\n * @param {Object} schemaOptions\r\n * @inherits SchemaArray\r\n * @api public\r\n */\r\n\r\nfunction DocumentArrayPath(key, schema, options, schemaOptions) {\r\n  const schemaTypeIdOption = DocumentArrayPath.defaultOptions &&\r\n    DocumentArrayPath.defaultOptions._id;\r\n  if (schemaTypeIdOption != null) {\r\n    schemaOptions = schemaOptions || {};\r\n    schemaOptions._id = schemaTypeIdOption;\r\n  }\r\n\r\n  if (schemaOptions != null && schemaOptions._id != null) {\r\n    schema = handleIdOption(schema, schemaOptions);\r\n  } else if (options != null && options._id != null) {\r\n    schema = handleIdOption(schema, options);\r\n  }\r\n\r\n  const EmbeddedDocument = _createConstructor(schema, options);\r\n  EmbeddedDocument.prototype.$basePath = key;\r\n\r\n  ArrayType.call(this, key, EmbeddedDocument, options);\r\n\r\n  this.schema = schema;\r\n  this.schemaOptions = schemaOptions || {};\r\n  this.$isMongooseDocumentArray = true;\r\n  this.Constructor = EmbeddedDocument;\r\n\r\n  EmbeddedDocument.base = schema.base;\r\n\r\n  const fn = this.defaultValue;\r\n\r\n  if (!('defaultValue' in this) || fn !== void 0) {\r\n    this.default(function() {\r\n      let arr = fn.call(this);\r\n      if (arr != null && !Array.isArray(arr)) {\r\n        arr = [arr];\r\n      }\r\n      // Leave it up to `cast()` to convert this to a documentarray\r\n      return arr;\r\n    });\r\n  }\r\n\r\n  const parentSchemaType = this;\r\n  this.$embeddedSchemaType = new SchemaType(key + '.$', {\r\n    required: this &&\r\n      this.schemaOptions &&\r\n      this.schemaOptions.required || false\r\n  });\r\n  this.$embeddedSchemaType.cast = function(value, doc, init) {\r\n    return parentSchemaType.cast(value, doc, init)[0];\r\n  };\r\n  this.$embeddedSchemaType.doValidate = function(value, fn, scope, options) {\r\n    const Constructor = getConstructor(this.caster, value);\r\n\r\n    if (value && !(value instanceof Constructor)) {\r\n      value = new Constructor(value, scope, null, null, options && options.index != null ? options.index : null);\r\n    }\r\n\r\n    return SubdocumentPath.prototype.doValidate.call(this, value, fn, scope, options);\r\n  };\r\n  this.$embeddedSchemaType.$isMongooseDocumentArrayElement = true;\r\n  this.$embeddedSchemaType.caster = this.Constructor;\r\n  this.$embeddedSchemaType.schema = this.schema;\r\n}\r\n\r\n/**\r\n * This schema type's name, to defend against minifiers that mangle\r\n * function names.\r\n *\r\n * @api public\r\n */\r\nDocumentArrayPath.schemaName = 'DocumentArray';\r\n\r\n/**\r\n * Options for all document arrays.\r\n *\r\n * - `castNonArrays`: `true` by default. If `false`, Mongoose will throw a CastError when a value isn't an array. If `true`, Mongoose will wrap the provided value in an array before casting.\r\n *\r\n * @api public\r\n */\r\n\r\nDocumentArrayPath.options = { castNonArrays: true };\r\n\r\n/*!\r\n * Inherits from ArrayType.\r\n */\r\nDocumentArrayPath.prototype = Object.create(ArrayType.prototype);\r\nDocumentArrayPath.prototype.constructor = DocumentArrayPath;\r\nDocumentArrayPath.prototype.OptionsConstructor = SchemaDocumentArrayOptions;\r\n\r\n/*!\r\n * ignore\r\n */\r\n\r\nfunction _createConstructor(schema, options, baseClass) {\r\n  Subdocument || (Subdocument = require('../types/ArraySubdocument'));\r\n\r\n  // compile an embedded document for this schema\r\n  function EmbeddedDocument() {\r\n    Subdocument.apply(this, arguments);\r\n    if (this.__parentArray == null || this.__parentArray.getArrayParent() == null) {\r\n      return;\r\n    }\r\n    this.$session(this.__parentArray.getArrayParent().$session());\r\n  }\r\n\r\n  schema._preCompile();\r\n\r\n  const proto = baseClass != null ? baseClass.prototype : Subdocument.prototype;\r\n  EmbeddedDocument.prototype = Object.create(proto);\r\n  EmbeddedDocument.prototype.$__setSchema(schema);\r\n  EmbeddedDocument.schema = schema;\r\n  EmbeddedDocument.prototype.constructor = EmbeddedDocument;\r\n  EmbeddedDocument.$isArraySubdocument = true;\r\n  EmbeddedDocument.events = new EventEmitter();\r\n  EmbeddedDocument.base = schema.base;\r\n\r\n  // apply methods\r\n  for (const i in schema.methods) {\r\n    EmbeddedDocument.prototype[i] = schema.methods[i];\r\n  }\r\n\r\n  // apply statics\r\n  for (const i in schema.statics) {\r\n    EmbeddedDocument[i] = schema.statics[i];\r\n  }\r\n\r\n  for (const i in EventEmitter.prototype) {\r\n    EmbeddedDocument[i] = EventEmitter.prototype[i];\r\n  }\r\n\r\n  EmbeddedDocument.options = options;\r\n\r\n  return EmbeddedDocument;\r\n}\r\n\r\n/**\r\n * Adds a discriminator to this document array.\r\n *\r\n * #### Example:\r\n *\r\n *     const shapeSchema = Schema({ name: String }, { discriminatorKey: 'kind' });\r\n *     const schema = Schema({ shapes: [shapeSchema] });\r\n *\r\n *     const docArrayPath = parentSchema.path('shapes');\r\n *     docArrayPath.discriminator('Circle', Schema({ radius: Number }));\r\n *\r\n * @param {String} name\r\n * @param {Schema} schema fields to add to the schema for instances of this sub-class\r\n * @param {Object|string} [options] If string, same as `options.value`.\r\n * @param {String} [options.value] the string stored in the `discriminatorKey` property. If not specified, Mongoose uses the `name` parameter.\r\n * @param {Boolean} [options.clone=true] By default, `discriminator()` clones the given `schema`. Set to `false` to skip cloning.\r\n * @see discriminators /docs/discriminators.html\r\n * @return {Function} the constructor Mongoose will use for creating instances of this discriminator model\r\n * @api public\r\n */\r\n\r\nDocumentArrayPath.prototype.discriminator = function(name, schema, options) {\r\n  if (typeof name === 'function') {\r\n    name = utils.getFunctionName(name);\r\n  }\r\n\r\n  options = options || {};\r\n  const tiedValue = utils.isPOJO(options) ? options.value : options;\r\n  const clone = typeof options.clone === 'boolean' ? options.clone : true;\r\n\r\n  if (schema.instanceOfSchema && clone) {\r\n    schema = schema.clone();\r\n  }\r\n\r\n  schema = discriminator(this.casterConstructor, name, schema, tiedValue);\r\n\r\n  const EmbeddedDocument = _createConstructor(schema, null, this.casterConstructor);\r\n  EmbeddedDocument.baseCasterConstructor = this.casterConstructor;\r\n\r\n  try {\r\n    Object.defineProperty(EmbeddedDocument, 'name', {\r\n      value: name\r\n    });\r\n  } catch (error) {\r\n    // Ignore error, only happens on old versions of node\r\n  }\r\n\r\n  this.casterConstructor.discriminators[name] = EmbeddedDocument;\r\n\r\n  return this.casterConstructor.discriminators[name];\r\n};\r\n\r\n/**\r\n * Performs local validations first, then validations on each embedded doc\r\n *\r\n * @api private\r\n */\r\n\r\nDocumentArrayPath.prototype.doValidate = function(array, fn, scope, options) {\r\n  // lazy load\r\n  MongooseDocumentArray || (MongooseDocumentArray = require('../types/DocumentArray'));\r\n\r\n  const _this = this;\r\n  try {\r\n    SchemaType.prototype.doValidate.call(this, array, cb, scope);\r\n  } catch (err) {\r\n    return fn(err);\r\n  }\r\n\r\n  function cb(err) {\r\n    if (err) {\r\n      return fn(err);\r\n    }\r\n\r\n    let count = array && array.length;\r\n    let error;\r\n\r\n    if (!count) {\r\n      return fn();\r\n    }\r\n    if (options && options.updateValidator) {\r\n      return fn();\r\n    }\r\n    if (!utils.isMongooseDocumentArray(array)) {\r\n      array = new MongooseDocumentArray(array, _this.path, scope);\r\n    }\r\n\r\n    // handle sparse arrays, do not use array.forEach which does not\r\n    // iterate over sparse elements yet reports array.length including\r\n    // them :(\r\n\r\n    function callback(err) {\r\n      if (err != null) {\r\n        error = err;\r\n      }\r\n      --count || fn(error);\r\n    }\r\n\r\n    for (let i = 0, len = count; i < len; ++i) {\r\n      // sidestep sparse entries\r\n      let doc = array[i];\r\n      if (doc == null) {\r\n        --count || fn(error);\r\n        continue;\r\n      }\r\n\r\n      // If you set the array index directly, the doc might not yet be\r\n      // a full fledged mongoose subdoc, so make it into one.\r\n      if (!(doc instanceof Subdocument)) {\r\n        const Constructor = getConstructor(_this.casterConstructor, array[i]);\r\n        doc = array[i] = new Constructor(doc, array, undefined, undefined, i);\r\n      }\r\n\r\n      if (options != null && options.validateModifiedOnly && !doc.$isModified()) {\r\n        --count || fn(error);\r\n        continue;\r\n      }\r\n\r\n      doc.$__validate(callback);\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * Performs local validations first, then validations on each embedded doc.\r\n *\r\n * #### Note:\r\n *\r\n * This method ignores the asynchronous validators.\r\n *\r\n * @return {MongooseError|undefined}\r\n * @api private\r\n */\r\n\r\nDocumentArrayPath.prototype.doValidateSync = function(array, scope, options) {\r\n  const schemaTypeError = SchemaType.prototype.doValidateSync.call(this, array, scope);\r\n  if (schemaTypeError != null) {\r\n    return schemaTypeError;\r\n  }\r\n\r\n  const count = array && array.length;\r\n  let resultError = null;\r\n\r\n  if (!count) {\r\n    return;\r\n  }\r\n\r\n  // handle sparse arrays, do not use array.forEach which does not\r\n  // iterate over sparse elements yet reports array.length including\r\n  // them :(\r\n\r\n  for (let i = 0, len = count; i < len; ++i) {\r\n    // sidestep sparse entries\r\n    let doc = array[i];\r\n    if (!doc) {\r\n      continue;\r\n    }\r\n\r\n    // If you set the array index directly, the doc might not yet be\r\n    // a full fledged mongoose subdoc, so make it into one.\r\n    if (!(doc instanceof Subdocument)) {\r\n      const Constructor = getConstructor(this.casterConstructor, array[i]);\r\n      doc = array[i] = new Constructor(doc, array, undefined, undefined, i);\r\n    }\r\n\r\n    if (options != null && options.validateModifiedOnly && !doc.$isModified()) {\r\n      continue;\r\n    }\r\n\r\n    const subdocValidateError = doc.validateSync();\r\n\r\n    if (subdocValidateError && resultError == null) {\r\n      resultError = subdocValidateError;\r\n    }\r\n  }\r\n\r\n  return resultError;\r\n};\r\n\r\n/*!\r\n * ignore\r\n */\r\n\r\nDocumentArrayPath.prototype.getDefault = function(scope, init, options) {\r\n  let ret = typeof this.defaultValue === 'function'\r\n    ? this.defaultValue.call(scope)\r\n    : this.defaultValue;\r\n\r\n  if (ret == null) {\r\n    return ret;\r\n  }\r\n\r\n  if (options && options.skipCast) {\r\n    return ret;\r\n  }\r\n\r\n  // lazy load\r\n  MongooseDocumentArray || (MongooseDocumentArray = require('../types/DocumentArray'));\r\n\r\n  if (!Array.isArray(ret)) {\r\n    ret = [ret];\r\n  }\r\n\r\n  ret = new MongooseDocumentArray(ret, this.path, scope);\r\n\r\n  for (let i = 0; i < ret.length; ++i) {\r\n    const Constructor = getConstructor(this.casterConstructor, ret[i]);\r\n    const _subdoc = new Constructor({}, ret, undefined,\r\n      undefined, i);\r\n    _subdoc.$init(ret[i]);\r\n    _subdoc.isNew = true;\r\n\r\n    // Make sure all paths in the subdoc are set to `default` instead\r\n    // of `init` since we used `init`.\r\n    Object.assign(_subdoc.$__.activePaths.default, _subdoc.$__.activePaths.init);\r\n    _subdoc.$__.activePaths.init = {};\r\n\r\n    ret[i] = _subdoc;\r\n  }\r\n\r\n  return ret;\r\n};\r\n\r\nconst _toObjectOptions = Object.freeze({ transform: false, virtuals: false });\r\nconst initDocumentOptions = Object.freeze({ skipId: false, willInit: true });\r\n\r\n/**\r\n * Casts contents\r\n *\r\n * @param {Object} value\r\n * @param {Document} document that triggers the casting\r\n * @api private\r\n */\r\n\r\nDocumentArrayPath.prototype.cast = function(value, doc, init, prev, options) {\r\n  // lazy load\r\n  MongooseDocumentArray || (MongooseDocumentArray = require('../types/DocumentArray'));\r\n\r\n  // Skip casting if `value` is the same as the previous value, no need to cast. See gh-9266\r\n  if (value != null && value[arrayPathSymbol] != null && value === prev) {\r\n    return value;\r\n  }\r\n\r\n  let selected;\r\n  let subdoc;\r\n\r\n  options = options || {};\r\n\r\n  if (!Array.isArray(value)) {\r\n    if (!init && !DocumentArrayPath.options.castNonArrays) {\r\n      throw new CastError('DocumentArray', value, this.path, null, this);\r\n    }\r\n    // gh-2442 mark whole array as modified if we're initializing a doc from\r\n    // the db and the path isn't an array in the document\r\n    if (!!doc && init) {\r\n      doc.markModified(this.path);\r\n    }\r\n    return this.cast([value], doc, init, prev, options);\r\n  }\r\n\r\n  // We need to create a new array, otherwise change tracking will\r\n  // update the old doc (gh-4449)\r\n  if (!options.skipDocumentArrayCast || utils.isMongooseDocumentArray(value)) {\r\n    value = new MongooseDocumentArray(value, this.path, doc);\r\n  }\r\n\r\n  if (prev != null) {\r\n    value[arrayAtomicsSymbol] = prev[arrayAtomicsSymbol] || {};\r\n  }\r\n\r\n  if (options.arrayPathIndex != null) {\r\n    value[arrayPathSymbol] = this.path + '.' + options.arrayPathIndex;\r\n  }\r\n\r\n  const rawArray = utils.isMongooseDocumentArray(value) ? value.__array : value;\r\n  const len = rawArray.length;\r\n\r\n  for (let i = 0; i < len; ++i) {\r\n    if (!rawArray[i]) {\r\n      continue;\r\n    }\r\n\r\n    const Constructor = getConstructor(this.casterConstructor, rawArray[i]);\r\n\r\n    // Check if the document has a different schema (re gh-3701)\r\n    if (rawArray[i].$__ != null && !(rawArray[i] instanceof Constructor)) {\r\n      const spreadDoc = handleSpreadDoc(rawArray[i], true);\r\n      if (rawArray[i] !== spreadDoc) {\r\n        rawArray[i] = spreadDoc;\r\n      } else {\r\n        rawArray[i] = rawArray[i].toObject({\r\n          transform: false,\r\n          // Special case: if different model, but same schema, apply virtuals\r\n          // re: gh-7898\r\n          virtuals: rawArray[i].schema === Constructor.schema\r\n        });\r\n      }\r\n    }\r\n\r\n    if (rawArray[i] instanceof Subdocument) {\r\n      if (rawArray[i][documentArrayParent] !== doc) {\r\n        if (init) {\r\n          const subdoc = new Constructor(null, value, initDocumentOptions, selected, i);\r\n          rawArray[i] = subdoc.$init(rawArray[i]);\r\n        } else {\r\n          const subdoc = new Constructor(rawArray[i], value, undefined, undefined, i);\r\n          rawArray[i] = subdoc;\r\n        }\r\n      }\r\n      // Might not have the correct index yet, so ensure it does.\r\n      if (rawArray[i].__index == null) {\r\n        rawArray[i].$setIndex(i);\r\n      }\r\n    } else if (rawArray[i] != null) {\r\n      if (init) {\r\n        if (doc) {\r\n          selected || (selected = scopePaths(this, doc.$__.selected, init));\r\n        } else {\r\n          selected = true;\r\n        }\r\n\r\n        subdoc = new Constructor(null, value, initDocumentOptions, selected, i);\r\n        rawArray[i] = subdoc.$init(rawArray[i]);\r\n      } else {\r\n        if (prev && typeof prev.id === 'function') {\r\n          subdoc = prev.id(rawArray[i]._id);\r\n        }\r\n\r\n        if (prev && subdoc && utils.deepEqual(subdoc.toObject(_toObjectOptions), rawArray[i])) {\r\n          // handle resetting doc with existing id and same data\r\n          subdoc.set(rawArray[i]);\r\n          // if set() is hooked it will have no return value\r\n          // see gh-746\r\n          rawArray[i] = subdoc;\r\n        } else {\r\n          try {\r\n            subdoc = new Constructor(rawArray[i], value, undefined,\r\n              undefined, i);\r\n            // if set() is hooked it will have no return value\r\n            // see gh-746\r\n            rawArray[i] = subdoc;\r\n          } catch (error) {\r\n            throw new CastError('embedded', rawArray[i],\r\n              value[arrayPathSymbol], error, this);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return value;\r\n};\r\n\r\n/*!\r\n * ignore\r\n */\r\n\r\nDocumentArrayPath.prototype.clone = function() {\r\n  const options = Object.assign({}, this.options);\r\n  const schematype = new this.constructor(this.path, this.schema, options, this.schemaOptions);\r\n  schematype.validators = this.validators.slice();\r\n  if (this.requiredValidator !== undefined) {\r\n    schematype.requiredValidator = this.requiredValidator;\r\n  }\r\n  schematype.Constructor.discriminators = Object.assign({},\r\n    this.Constructor.discriminators);\r\n  return schematype;\r\n};\r\n\r\n/*!\r\n * ignore\r\n */\r\n\r\nDocumentArrayPath.prototype.applyGetters = function(value, scope) {\r\n  return SchemaType.prototype.applyGetters.call(this, value, scope);\r\n};\r\n\r\n/**\r\n * Scopes paths selected in a query to this array.\r\n * Necessary for proper default application of subdocument values.\r\n *\r\n * @param {DocumentArrayPath} array the array to scope `fields` paths\r\n * @param {Object|undefined} fields the root fields selected in the query\r\n * @param {Boolean|undefined} init if we are being created part of a query result\r\n * @api private\r\n */\r\n\r\nfunction scopePaths(array, fields, init) {\r\n  if (!(init && fields)) {\r\n    return undefined;\r\n  }\r\n\r\n  const path = array.path + '.';\r\n  const keys = Object.keys(fields);\r\n  let i = keys.length;\r\n  const selected = {};\r\n  let hasKeys;\r\n  let key;\r\n  let sub;\r\n\r\n  while (i--) {\r\n    key = keys[i];\r\n    if (key.startsWith(path)) {\r\n      sub = key.substring(path.length);\r\n      if (sub === '$') {\r\n        continue;\r\n      }\r\n      if (sub.startsWith('$.')) {\r\n        sub = sub.substring(2);\r\n      }\r\n      hasKeys || (hasKeys = true);\r\n      selected[sub] = fields[key];\r\n    }\r\n  }\r\n\r\n  return hasKeys && selected || undefined;\r\n}\r\n\r\n/*!\r\n * ignore\r\n */\r\n\r\nDocumentArrayPath.defaultOptions = {};\r\n\r\n/**\r\n * Sets a default option for all DocumentArray instances.\r\n *\r\n * #### Example:\r\n *\r\n *     // Make all numbers have option `min` equal to 0.\r\n *     mongoose.Schema.DocumentArray.set('_id', false);\r\n *\r\n * @param {String} option The name of the option you'd like to set (e.g. trim, lowercase, etc...)\r\n * @param {Any} value The value of the option you'd like to set.\r\n * @return {void}\r\n * @function set\r\n * @static\r\n * @api public\r\n */\r\n\r\nDocumentArrayPath.set = SchemaType.set;\r\n\r\n/*!\r\n * Module exports.\r\n */\r\n\r\nmodule.exports = DocumentArrayPath;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}