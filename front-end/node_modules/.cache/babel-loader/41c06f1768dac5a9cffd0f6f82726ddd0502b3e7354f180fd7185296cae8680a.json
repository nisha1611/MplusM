{"ast":null,"code":"'use strict';\n\nconst applyTimestampsToChildren = require('../update/applyTimestampsToChildren');\nconst applyTimestampsToUpdate = require('../update/applyTimestampsToUpdate');\nconst get = require('../get');\nconst handleTimestampOption = require('../schema/handleTimestampOption');\nconst setDocumentTimestamps = require('./setDocumentTimestamps');\nconst symbols = require('../../schema/symbols');\nmodule.exports = function setupTimestamps(schema, timestamps) {\n  const childHasTimestamp = schema.childSchemas.find(withTimestamp);\n  function withTimestamp(s) {\n    const ts = s.schema.options.timestamps;\n    return !!ts;\n  }\n  if (!timestamps && !childHasTimestamp) {\n    return;\n  }\n  const createdAt = handleTimestampOption(timestamps, 'createdAt');\n  const updatedAt = handleTimestampOption(timestamps, 'updatedAt');\n  const currentTime = timestamps != null && timestamps.hasOwnProperty('currentTime') ? timestamps.currentTime : null;\n  const schemaAdditions = {};\n  schema.$timestamps = {\n    createdAt: createdAt,\n    updatedAt: updatedAt\n  };\n  if (createdAt && !schema.paths[createdAt]) {\n    const baseImmutableCreatedAt = schema.base != null ? schema.base.get('timestamps.createdAt.immutable') : null;\n    const immutable = baseImmutableCreatedAt != null ? baseImmutableCreatedAt : true;\n    schemaAdditions[createdAt] = {\n      [schema.options.typeKey || 'type']: Date,\n      immutable\n    };\n  }\n  if (updatedAt && !schema.paths[updatedAt]) {\n    schemaAdditions[updatedAt] = Date;\n  }\n  schema.add(schemaAdditions);\n  schema.pre('save', function timestampsPreSave(next) {\n    const timestampOption = get(this, '$__.saveOptions.timestamps');\n    if (timestampOption === false) {\n      return next();\n    }\n    setDocumentTimestamps(this, timestampOption, currentTime, createdAt, updatedAt);\n    next();\n  });\n  schema.methods.initializeTimestamps = function () {\n    const ts = currentTime != null ? currentTime() : this.constructor.base.now();\n    if (createdAt && !this.get(createdAt)) {\n      this.$set(createdAt, ts);\n    }\n    if (updatedAt && !this.get(updatedAt)) {\n      this.$set(updatedAt, ts);\n    }\n    if (this.$isSubdocument) {\n      return this;\n    }\n    const subdocs = this.$getAllSubdocs();\n    for (const subdoc of subdocs) {\n      if (subdoc.initializeTimestamps) {\n        subdoc.initializeTimestamps();\n      }\n    }\n    return this;\n  };\n  _setTimestampsOnUpdate[symbols.builtInMiddleware] = true;\n  const opts = {\n    query: true,\n    model: false\n  };\n  schema.pre('findOneAndReplace', opts, _setTimestampsOnUpdate);\n  schema.pre('findOneAndUpdate', opts, _setTimestampsOnUpdate);\n  schema.pre('replaceOne', opts, _setTimestampsOnUpdate);\n  schema.pre('update', opts, _setTimestampsOnUpdate);\n  schema.pre('updateOne', opts, _setTimestampsOnUpdate);\n  schema.pre('updateMany', opts, _setTimestampsOnUpdate);\n  function _setTimestampsOnUpdate(next) {\n    const now = currentTime != null ? currentTime() : this.model.base.now();\n    // Replacing with null update should still trigger timestamps\n    if (this.op === 'findOneAndReplace' && this.getUpdate() == null) {\n      this.setUpdate({});\n    }\n    applyTimestampsToUpdate(now, createdAt, updatedAt, this.getUpdate(), this.options, this.schema);\n    applyTimestampsToChildren(now, this.getUpdate(), this.model.schema);\n    next();\n  }\n};","map":{"version":3,"names":["applyTimestampsToChildren","require","applyTimestampsToUpdate","get","handleTimestampOption","setDocumentTimestamps","symbols","module","exports","setupTimestamps","schema","timestamps","childHasTimestamp","childSchemas","find","withTimestamp","s","ts","options","createdAt","updatedAt","currentTime","hasOwnProperty","schemaAdditions","$timestamps","paths","baseImmutableCreatedAt","base","immutable","typeKey","Date","add","pre","timestampsPreSave","next","timestampOption","methods","initializeTimestamps","constructor","now","$set","$isSubdocument","subdocs","$getAllSubdocs","subdoc","_setTimestampsOnUpdate","builtInMiddleware","opts","query","model","op","getUpdate","setUpdate"],"sources":["C:/Users/91930/Desktop/Github projects/Pharmacy Demo/back-end/node_modules/mongoose/lib/helpers/timestamps/setupTimestamps.js"],"sourcesContent":["'use strict';\r\n\r\nconst applyTimestampsToChildren = require('../update/applyTimestampsToChildren');\r\nconst applyTimestampsToUpdate = require('../update/applyTimestampsToUpdate');\r\nconst get = require('../get');\r\nconst handleTimestampOption = require('../schema/handleTimestampOption');\r\nconst setDocumentTimestamps = require('./setDocumentTimestamps');\r\nconst symbols = require('../../schema/symbols');\r\n\r\nmodule.exports = function setupTimestamps(schema, timestamps) {\r\n  const childHasTimestamp = schema.childSchemas.find(withTimestamp);\r\n  function withTimestamp(s) {\r\n    const ts = s.schema.options.timestamps;\r\n    return !!ts;\r\n  }\r\n\r\n  if (!timestamps && !childHasTimestamp) {\r\n    return;\r\n  }\r\n\r\n  const createdAt = handleTimestampOption(timestamps, 'createdAt');\r\n  const updatedAt = handleTimestampOption(timestamps, 'updatedAt');\r\n  const currentTime = timestamps != null && timestamps.hasOwnProperty('currentTime') ?\r\n    timestamps.currentTime :\r\n    null;\r\n  const schemaAdditions = {};\r\n\r\n  schema.$timestamps = { createdAt: createdAt, updatedAt: updatedAt };\r\n\r\n  if (createdAt && !schema.paths[createdAt]) {\r\n    const baseImmutableCreatedAt = schema.base != null ? schema.base.get('timestamps.createdAt.immutable') : null;\r\n    const immutable = baseImmutableCreatedAt != null ? baseImmutableCreatedAt : true;\r\n    schemaAdditions[createdAt] = { [schema.options.typeKey || 'type']: Date, immutable };\r\n  }\r\n\r\n  if (updatedAt && !schema.paths[updatedAt]) {\r\n    schemaAdditions[updatedAt] = Date;\r\n  }\r\n\r\n  schema.add(schemaAdditions);\r\n\r\n  schema.pre('save', function timestampsPreSave(next) {\r\n    const timestampOption = get(this, '$__.saveOptions.timestamps');\r\n    if (timestampOption === false) {\r\n      return next();\r\n    }\r\n\r\n    setDocumentTimestamps(this, timestampOption, currentTime, createdAt, updatedAt);\r\n\r\n    next();\r\n  });\r\n\r\n  schema.methods.initializeTimestamps = function() {\r\n    const ts = currentTime != null ?\r\n      currentTime() :\r\n      this.constructor.base.now();\r\n    if (createdAt && !this.get(createdAt)) {\r\n      this.$set(createdAt, ts);\r\n    }\r\n    if (updatedAt && !this.get(updatedAt)) {\r\n      this.$set(updatedAt, ts);\r\n    }\r\n\r\n    if (this.$isSubdocument) {\r\n      return this;\r\n    }\r\n\r\n    const subdocs = this.$getAllSubdocs();\r\n    for (const subdoc of subdocs) {\r\n      if (subdoc.initializeTimestamps) {\r\n        subdoc.initializeTimestamps();\r\n      }\r\n    }\r\n\r\n    return this;\r\n  };\r\n\r\n  _setTimestampsOnUpdate[symbols.builtInMiddleware] = true;\r\n\r\n  const opts = { query: true, model: false };\r\n  schema.pre('findOneAndReplace', opts, _setTimestampsOnUpdate);\r\n  schema.pre('findOneAndUpdate', opts, _setTimestampsOnUpdate);\r\n  schema.pre('replaceOne', opts, _setTimestampsOnUpdate);\r\n  schema.pre('update', opts, _setTimestampsOnUpdate);\r\n  schema.pre('updateOne', opts, _setTimestampsOnUpdate);\r\n  schema.pre('updateMany', opts, _setTimestampsOnUpdate);\r\n\r\n  function _setTimestampsOnUpdate(next) {\r\n    const now = currentTime != null ?\r\n      currentTime() :\r\n      this.model.base.now();\r\n    // Replacing with null update should still trigger timestamps\r\n    if (this.op === 'findOneAndReplace' && this.getUpdate() == null) {\r\n      this.setUpdate({});\r\n    }\r\n    applyTimestampsToUpdate(now, createdAt, updatedAt, this.getUpdate(),\r\n      this.options, this.schema);\r\n    applyTimestampsToChildren(now, this.getUpdate(), this.model.schema);\r\n    next();\r\n  }\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}