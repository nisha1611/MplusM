{"ast":null,"code":"'use strict';\n\n/*!\r\n * Module dependencies.\r\n */\nconst ms = require('ms');\nconst mpath = require('mpath');\nconst ObjectId = require('./types/objectid');\nconst PopulateOptions = require('./options/PopulateOptions');\nconst clone = require('./helpers/clone');\nconst immediate = require('./helpers/immediate');\nconst isObject = require('./helpers/isObject');\nconst isMongooseArray = require('./types/array/isMongooseArray');\nconst isMongooseDocumentArray = require('./types/DocumentArray/isMongooseDocumentArray');\nconst isBsonType = require('./helpers/isBsonType');\nconst getFunctionName = require('./helpers/getFunctionName');\nconst isMongooseObject = require('./helpers/isMongooseObject');\nconst promiseOrCallback = require('./helpers/promiseOrCallback');\nconst schemaMerge = require('./helpers/schema/merge');\nconst specialProperties = require('./helpers/specialProperties');\nconst {\n  trustedSymbol\n} = require('./helpers/query/trusted');\nlet Document;\nexports.specialProperties = specialProperties;\nexports.isMongooseArray = isMongooseArray.isMongooseArray;\nexports.isMongooseDocumentArray = isMongooseDocumentArray.isMongooseDocumentArray;\nexports.registerMongooseArray = isMongooseArray.registerMongooseArray;\nexports.registerMongooseDocumentArray = isMongooseDocumentArray.registerMongooseDocumentArray;\n\n/**\r\n * Produces a collection name from model `name`. By default, just returns\r\n * the model name\r\n *\r\n * @param {String} name a model name\r\n * @param {Function} pluralize function that pluralizes the collection name\r\n * @return {String} a collection name\r\n * @api private\r\n */\n\nexports.toCollectionName = function (name, pluralize) {\n  if (name === 'system.profile') {\n    return name;\n  }\n  if (name === 'system.indexes') {\n    return name;\n  }\n  if (typeof pluralize === 'function') {\n    return pluralize(name);\n  }\n  return name;\n};\n\n/**\r\n * Determines if `a` and `b` are deep equal.\r\n *\r\n * Modified from node/lib/assert.js\r\n *\r\n * @param {any} a a value to compare to `b`\r\n * @param {any} b a value to compare to `a`\r\n * @return {Boolean}\r\n * @api private\r\n */\n\nexports.deepEqual = function deepEqual(a, b) {\n  if (a === b) {\n    return true;\n  }\n  if (typeof a !== 'object' || typeof b !== 'object') {\n    return a === b;\n  }\n  if (a instanceof Date && b instanceof Date) {\n    return a.getTime() === b.getTime();\n  }\n  if (isBsonType(a, 'ObjectID') && isBsonType(b, 'ObjectID') || isBsonType(a, 'Decimal128') && isBsonType(b, 'Decimal128')) {\n    return a.toString() === b.toString();\n  }\n  if (a instanceof RegExp && b instanceof RegExp) {\n    return a.source === b.source && a.ignoreCase === b.ignoreCase && a.multiline === b.multiline && a.global === b.global && a.dotAll === b.dotAll && a.unicode === b.unicode && a.sticky === b.sticky && a.hasIndices === b.hasIndices;\n  }\n  if (a == null || b == null) {\n    return false;\n  }\n  if (a.prototype !== b.prototype) {\n    return false;\n  }\n  if (a instanceof Map || b instanceof Map) {\n    if (!(a instanceof Map) || !(b instanceof Map)) {\n      return false;\n    }\n    return deepEqual(Array.from(a.keys()), Array.from(b.keys())) && deepEqual(Array.from(a.values()), Array.from(b.values()));\n  }\n\n  // Handle MongooseNumbers\n  if (a instanceof Number && b instanceof Number) {\n    return a.valueOf() === b.valueOf();\n  }\n  if (Buffer.isBuffer(a)) {\n    return exports.buffer.areEqual(a, b);\n  }\n  if (Array.isArray(a) || Array.isArray(b)) {\n    if (!Array.isArray(a) || !Array.isArray(b)) {\n      return false;\n    }\n    const len = a.length;\n    if (len !== b.length) {\n      return false;\n    }\n    for (let i = 0; i < len; ++i) {\n      if (!deepEqual(a[i], b[i])) {\n        return false;\n      }\n    }\n    return true;\n  }\n  if (a.$__ != null) {\n    a = a._doc;\n  } else if (isMongooseObject(a)) {\n    a = a.toObject();\n  }\n  if (b.$__ != null) {\n    b = b._doc;\n  } else if (isMongooseObject(b)) {\n    b = b.toObject();\n  }\n  const ka = Object.keys(a);\n  const kb = Object.keys(b);\n  const kaLength = ka.length;\n\n  // having the same number of owned properties (keys incorporates\n  // hasOwnProperty)\n  if (kaLength !== kb.length) {\n    return false;\n  }\n\n  // ~~~cheap key test\n  for (let i = kaLength - 1; i >= 0; i--) {\n    if (ka[i] !== kb[i]) {\n      return false;\n    }\n  }\n\n  // equivalent values for every corresponding key, and\n  // ~~~possibly expensive deep test\n  for (const key of ka) {\n    if (!deepEqual(a[key], b[key])) {\n      return false;\n    }\n  }\n  return true;\n};\n\n/**\r\n * Get the last element of an array\r\n * @param {Array} arr\r\n */\n\nexports.last = function (arr) {\n  if (arr.length > 0) {\n    return arr[arr.length - 1];\n  }\n  return void 0;\n};\nexports.clone = clone;\n\n/*!\r\n * ignore\r\n */\n\nexports.promiseOrCallback = promiseOrCallback;\n\n/*!\r\n * ignore\r\n */\n\nexports.cloneArrays = function cloneArrays(arr) {\n  if (!Array.isArray(arr)) {\n    return arr;\n  }\n  return arr.map(el => exports.cloneArrays(el));\n};\n\n/*!\r\n * ignore\r\n */\n\nexports.omit = function omit(obj, keys) {\n  if (keys == null) {\n    return Object.assign({}, obj);\n  }\n  if (!Array.isArray(keys)) {\n    keys = [keys];\n  }\n  const ret = Object.assign({}, obj);\n  for (const key of keys) {\n    delete ret[key];\n  }\n  return ret;\n};\n\n/**\r\n * Shallow copies defaults into options.\r\n *\r\n * @param {Object} defaults\r\n * @param {Object} [options]\r\n * @return {Object} the merged object\r\n * @api private\r\n */\n\nexports.options = function (defaults, options) {\n  const keys = Object.keys(defaults);\n  let i = keys.length;\n  let k;\n  options = options || {};\n  while (i--) {\n    k = keys[i];\n    if (!(k in options)) {\n      options[k] = defaults[k];\n    }\n  }\n  return options;\n};\n\n/**\r\n * Merges `from` into `to` without overwriting existing properties.\r\n *\r\n * @param {Object} to\r\n * @param {Object} from\r\n * @param {Object} [options]\r\n * @param {String} [path]\r\n * @api private\r\n */\n\nexports.merge = function merge(to, from, options, path) {\n  options = options || {};\n  const keys = Object.keys(from);\n  let i = 0;\n  const len = keys.length;\n  let key;\n  if (from[trustedSymbol]) {\n    to[trustedSymbol] = from[trustedSymbol];\n  }\n  path = path || '';\n  const omitNested = options.omitNested || {};\n  while (i < len) {\n    key = keys[i++];\n    if (options.omit && options.omit[key]) {\n      continue;\n    }\n    if (omitNested[path]) {\n      continue;\n    }\n    if (specialProperties.has(key)) {\n      continue;\n    }\n    if (to[key] == null) {\n      to[key] = from[key];\n    } else if (exports.isObject(from[key])) {\n      if (!exports.isObject(to[key])) {\n        to[key] = {};\n      }\n      if (from[key] != null) {\n        // Skip merging schemas if we're creating a discriminator schema and\n        // base schema has a given path as a single nested but discriminator schema\n        // has the path as a document array, or vice versa (gh-9534)\n        if (options.isDiscriminatorSchemaMerge && from[key].$isSingleNested && to[key].$isMongooseDocumentArray || from[key].$isMongooseDocumentArray && to[key].$isSingleNested) {\n          continue;\n        } else if (from[key].instanceOfSchema) {\n          if (to[key].instanceOfSchema) {\n            schemaMerge(to[key], from[key].clone(), options.isDiscriminatorSchemaMerge);\n          } else {\n            to[key] = from[key].clone();\n          }\n          continue;\n        } else if (isBsonType(from[key], 'ObjectID')) {\n          to[key] = new ObjectId(from[key]);\n          continue;\n        }\n      }\n      merge(to[key], from[key], options, path ? path + '.' + key : key);\n    } else if (options.overwrite) {\n      to[key] = from[key];\n    }\n  }\n};\n\n/**\r\n * Applies toObject recursively.\r\n *\r\n * @param {Document|Array|Object} obj\r\n * @return {Object}\r\n * @api private\r\n */\n\nexports.toObject = function toObject(obj) {\n  Document || (Document = require('./document'));\n  let ret;\n  if (obj == null) {\n    return obj;\n  }\n  if (obj instanceof Document) {\n    return obj.toObject();\n  }\n  if (Array.isArray(obj)) {\n    ret = [];\n    for (const doc of obj) {\n      ret.push(toObject(doc));\n    }\n    return ret;\n  }\n  if (exports.isPOJO(obj)) {\n    ret = {};\n    if (obj[trustedSymbol]) {\n      ret[trustedSymbol] = obj[trustedSymbol];\n    }\n    for (const k of Object.keys(obj)) {\n      if (specialProperties.has(k)) {\n        continue;\n      }\n      ret[k] = toObject(obj[k]);\n    }\n    return ret;\n  }\n  return obj;\n};\nexports.isObject = isObject;\n\n/**\r\n * Determines if `arg` is a plain old JavaScript object (POJO). Specifically,\r\n * `arg` must be an object but not an instance of any special class, like String,\r\n * ObjectId, etc.\r\n *\r\n * `Object.getPrototypeOf()` is part of ES5: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/getPrototypeOf\r\n *\r\n * @param {Object|Array|String|Function|RegExp|any} arg\r\n * @api private\r\n * @return {Boolean}\r\n */\n\nexports.isPOJO = function isPOJO(arg) {\n  if (arg == null || typeof arg !== 'object') {\n    return false;\n  }\n  const proto = Object.getPrototypeOf(arg);\n  // Prototype may be null if you used `Object.create(null)`\n  // Checking `proto`'s constructor is safe because `getPrototypeOf()`\n  // explicitly crosses the boundary from object data to object metadata\n  return !proto || proto.constructor.name === 'Object';\n};\n\n/**\r\n * Determines if `arg` is an object that isn't an instance of a built-in value\r\n * class, like Array, Buffer, ObjectId, etc.\r\n * @param {Any} val\r\n */\n\nexports.isNonBuiltinObject = function isNonBuiltinObject(val) {\n  return typeof val === 'object' && !exports.isNativeObject(val) && !exports.isMongooseType(val) && val != null;\n};\n\n/**\r\n * Determines if `obj` is a built-in object like an array, date, boolean,\r\n * etc.\r\n * @param {Any} arg\r\n */\n\nexports.isNativeObject = function (arg) {\n  return Array.isArray(arg) || arg instanceof Date || arg instanceof Boolean || arg instanceof Number || arg instanceof String;\n};\n\n/**\r\n * Determines if `val` is an object that has no own keys\r\n * @param {Any} val\r\n */\n\nexports.isEmptyObject = function (val) {\n  return val != null && typeof val === 'object' && Object.keys(val).length === 0;\n};\n\n/**\r\n * Search if `obj` or any POJOs nested underneath `obj` has a property named\r\n * `key`\r\n * @param {Object} obj\r\n * @param {String} key\r\n */\n\nexports.hasKey = function hasKey(obj, key) {\n  const props = Object.keys(obj);\n  for (const prop of props) {\n    if (prop === key) {\n      return true;\n    }\n    if (exports.isPOJO(obj[prop]) && exports.hasKey(obj[prop], key)) {\n      return true;\n    }\n  }\n  return false;\n};\n\n/**\r\n * process.nextTick helper.\r\n *\r\n * Wraps `callback` in a try/catch + nextTick.\r\n *\r\n * node-mongodb-native has a habit of state corruption when an error is immediately thrown from within a collection callback.\r\n *\r\n * @param {Function} callback\r\n * @api private\r\n */\n\nexports.tick = function tick(callback) {\n  if (typeof callback !== 'function') {\n    return;\n  }\n  return function () {\n    try {\n      callback.apply(this, arguments);\n    } catch (err) {\n      // only nextTick on err to get out of\n      // the event loop and avoid state corruption.\n      immediate(function () {\n        throw err;\n      });\n    }\n  };\n};\n\n/**\r\n * Returns true if `v` is an object that can be serialized as a primitive in\r\n * MongoDB\r\n * @param {Any} v\r\n */\n\nexports.isMongooseType = function (v) {\n  return isBsonType(v, 'ObjectID') || isBsonType(v, 'Decimal128') || v instanceof Buffer;\n};\nexports.isMongooseObject = isMongooseObject;\n\n/**\r\n * Converts `expires` options of index objects to `expiresAfterSeconds` options for MongoDB.\r\n *\r\n * @param {Object} object\r\n * @api private\r\n */\n\nexports.expires = function expires(object) {\n  if (!(object && object.constructor.name === 'Object')) {\n    return;\n  }\n  if (!('expires' in object)) {\n    return;\n  }\n  object.expireAfterSeconds = typeof object.expires !== 'string' ? object.expires : Math.round(ms(object.expires) / 1000);\n  delete object.expires;\n};\n\n/**\r\n * populate helper\r\n * @param {String} path\r\n * @param {String} select\r\n * @param {Model} model\r\n * @param {Object} match\r\n * @param {Object} options\r\n * @param {Any} subPopulate\r\n * @param {Boolean} justOne\r\n * @param {Boolean} count\r\n */\n\nexports.populate = function populate(path, select, model, match, options, subPopulate, justOne, count) {\n  // might have passed an object specifying all arguments\n  let obj = null;\n  if (arguments.length === 1) {\n    if (path instanceof PopulateOptions) {\n      // If reusing old populate docs, avoid reusing `_docs` because that may\n      // lead to bugs and memory leaks. See gh-11641\n      path._docs = [];\n      path._childDocs = [];\n      return [path];\n    }\n    if (Array.isArray(path)) {\n      const singles = makeSingles(path);\n      return singles.map(o => exports.populate(o)[0]);\n    }\n    if (exports.isObject(path)) {\n      obj = Object.assign({}, path);\n    } else {\n      obj = {\n        path: path\n      };\n    }\n  } else if (typeof model === 'object') {\n    obj = {\n      path: path,\n      select: select,\n      match: model,\n      options: match\n    };\n  } else {\n    obj = {\n      path: path,\n      select: select,\n      model: model,\n      match: match,\n      options: options,\n      populate: subPopulate,\n      justOne: justOne,\n      count: count\n    };\n  }\n  if (typeof obj.path !== 'string') {\n    throw new TypeError('utils.populate: invalid path. Expected string. Got typeof `' + typeof path + '`');\n  }\n  return _populateObj(obj);\n\n  // The order of select/conditions args is opposite Model.find but\n  // necessary to keep backward compatibility (select could be\n  // an array, string, or object literal).\n  function makeSingles(arr) {\n    const ret = [];\n    arr.forEach(function (obj) {\n      if (/[\\s]/.test(obj.path)) {\n        const paths = obj.path.split(' ');\n        paths.forEach(function (p) {\n          const copy = Object.assign({}, obj);\n          copy.path = p;\n          ret.push(copy);\n        });\n      } else {\n        ret.push(obj);\n      }\n    });\n    return ret;\n  }\n};\nfunction _populateObj(obj) {\n  if (Array.isArray(obj.populate)) {\n    const ret = [];\n    obj.populate.forEach(function (obj) {\n      if (/[\\s]/.test(obj.path)) {\n        const copy = Object.assign({}, obj);\n        const paths = copy.path.split(' ');\n        paths.forEach(function (p) {\n          copy.path = p;\n          ret.push(exports.populate(copy)[0]);\n        });\n      } else {\n        ret.push(exports.populate(obj)[0]);\n      }\n    });\n    obj.populate = exports.populate(ret);\n  } else if (obj.populate != null && typeof obj.populate === 'object') {\n    obj.populate = exports.populate(obj.populate);\n  }\n  const ret = [];\n  const paths = obj.path.split(' ');\n  if (obj.options != null) {\n    obj.options = exports.clone(obj.options);\n  }\n  for (const path of paths) {\n    ret.push(new PopulateOptions(Object.assign({}, obj, {\n      path: path\n    })));\n  }\n  return ret;\n}\n\n/**\r\n * Return the value of `obj` at the given `path`.\r\n *\r\n * @param {String} path\r\n * @param {Object} obj\r\n * @param {Any} map\r\n */\n\nexports.getValue = function (path, obj, map) {\n  return mpath.get(path, obj, '_doc', map);\n};\n\n/**\r\n * Sets the value of `obj` at the given `path`.\r\n *\r\n * @param {String} path\r\n * @param {Anything} val\r\n * @param {Object} obj\r\n * @param {Any} map\r\n * @param {Any} _copying\r\n */\n\nexports.setValue = function (path, val, obj, map, _copying) {\n  mpath.set(path, val, obj, '_doc', map, _copying);\n};\n\n/**\r\n * Returns an array of values from object `o`.\r\n *\r\n * @param {Object} o\r\n * @return {Array}\r\n * @api private\r\n */\n\nexports.object = {};\nexports.object.vals = function vals(o) {\n  const keys = Object.keys(o);\n  let i = keys.length;\n  const ret = [];\n  while (i--) {\n    ret.push(o[keys[i]]);\n  }\n  return ret;\n};\n\n/**\r\n * @see exports.options\r\n */\n\nexports.object.shallowCopy = exports.options;\nconst hop = Object.prototype.hasOwnProperty;\n\n/**\r\n * Safer helper for hasOwnProperty checks\r\n *\r\n * @param {Object} obj\r\n * @param {String} prop\r\n */\n\nexports.object.hasOwnProperty = function (obj, prop) {\n  return hop.call(obj, prop);\n};\n\n/**\r\n * Determine if `val` is null or undefined\r\n *\r\n * @param {Any} val\r\n * @return {Boolean}\r\n */\n\nexports.isNullOrUndefined = function (val) {\n  return val === null || val === undefined;\n};\n\n/*!\r\n * ignore\r\n */\n\nexports.array = {};\n\n/**\r\n * Flattens an array.\r\n *\r\n * [ 1, [ 2, 3, [4] ]] -> [1,2,3,4]\r\n *\r\n * @param {Array} arr\r\n * @param {Function} [filter] If passed, will be invoked with each item in the array. If `filter` returns a falsy value, the item will not be included in the results.\r\n * @param {Array} ret\r\n * @return {Array}\r\n * @api private\r\n */\n\nexports.array.flatten = function flatten(arr, filter, ret) {\n  ret || (ret = []);\n  arr.forEach(function (item) {\n    if (Array.isArray(item)) {\n      flatten(item, filter, ret);\n    } else {\n      if (!filter || filter(item)) {\n        ret.push(item);\n      }\n    }\n  });\n  return ret;\n};\n\n/*!\r\n * ignore\r\n */\n\nconst _hasOwnProperty = Object.prototype.hasOwnProperty;\nexports.hasUserDefinedProperty = function (obj, key) {\n  if (obj == null) {\n    return false;\n  }\n  if (Array.isArray(key)) {\n    for (const k of key) {\n      if (exports.hasUserDefinedProperty(obj, k)) {\n        return true;\n      }\n    }\n    return false;\n  }\n  if (_hasOwnProperty.call(obj, key)) {\n    return true;\n  }\n  if (typeof obj === 'object' && key in obj) {\n    const v = obj[key];\n    return v !== Object.prototype[key] && v !== Array.prototype[key];\n  }\n  return false;\n};\n\n/*!\r\n * ignore\r\n */\n\nconst MAX_ARRAY_INDEX = Math.pow(2, 32) - 1;\nexports.isArrayIndex = function (val) {\n  if (typeof val === 'number') {\n    return val >= 0 && val <= MAX_ARRAY_INDEX;\n  }\n  if (typeof val === 'string') {\n    if (!/^\\d+$/.test(val)) {\n      return false;\n    }\n    val = +val;\n    return val >= 0 && val <= MAX_ARRAY_INDEX;\n  }\n  return false;\n};\n\n/**\r\n * Removes duplicate values from an array\r\n *\r\n * [1, 2, 3, 3, 5] => [1, 2, 3, 5]\r\n * [ ObjectId(\"550988ba0c19d57f697dc45e\"), ObjectId(\"550988ba0c19d57f697dc45e\") ]\r\n *    => [ObjectId(\"550988ba0c19d57f697dc45e\")]\r\n *\r\n * @param {Array} arr\r\n * @return {Array}\r\n * @api private\r\n */\n\nexports.array.unique = function (arr) {\n  const primitives = new Set();\n  const ids = new Set();\n  const ret = [];\n  for (const item of arr) {\n    if (typeof item === 'number' || typeof item === 'string' || item == null) {\n      if (primitives.has(item)) {\n        continue;\n      }\n      ret.push(item);\n      primitives.add(item);\n    } else if (isBsonType(item, 'ObjectID')) {\n      if (ids.has(item.toString())) {\n        continue;\n      }\n      ret.push(item);\n      ids.add(item.toString());\n    } else {\n      ret.push(item);\n    }\n  }\n  return ret;\n};\nexports.buffer = {};\n\n/**\r\n * Determines if two buffers are equal.\r\n *\r\n * @param {Buffer} a\r\n * @param {Object} b\r\n */\n\nexports.buffer.areEqual = function (a, b) {\n  if (!Buffer.isBuffer(a)) {\n    return false;\n  }\n  if (!Buffer.isBuffer(b)) {\n    return false;\n  }\n  if (a.length !== b.length) {\n    return false;\n  }\n  for (let i = 0, len = a.length; i < len; ++i) {\n    if (a[i] !== b[i]) {\n      return false;\n    }\n  }\n  return true;\n};\nexports.getFunctionName = getFunctionName;\n\n/**\r\n * Decorate buffers\r\n * @param {Object} destination\r\n * @param {Object} source\r\n */\n\nexports.decorate = function (destination, source) {\n  for (const key in source) {\n    if (specialProperties.has(key)) {\n      continue;\n    }\n    destination[key] = source[key];\n  }\n};\n\n/**\r\n * merges to with a copy of from\r\n *\r\n * @param {Object} to\r\n * @param {Object} fromObj\r\n * @api private\r\n */\n\nexports.mergeClone = function (to, fromObj) {\n  if (isMongooseObject(fromObj)) {\n    fromObj = fromObj.toObject({\n      transform: false,\n      virtuals: false,\n      depopulate: true,\n      getters: false,\n      flattenDecimals: false\n    });\n  }\n  const keys = Object.keys(fromObj);\n  const len = keys.length;\n  let i = 0;\n  let key;\n  while (i < len) {\n    key = keys[i++];\n    if (specialProperties.has(key)) {\n      continue;\n    }\n    if (typeof to[key] === 'undefined') {\n      to[key] = exports.clone(fromObj[key], {\n        transform: false,\n        virtuals: false,\n        depopulate: true,\n        getters: false,\n        flattenDecimals: false\n      });\n    } else {\n      let val = fromObj[key];\n      if (val != null && val.valueOf && !(val instanceof Date)) {\n        val = val.valueOf();\n      }\n      if (exports.isObject(val)) {\n        let obj = val;\n        if (isMongooseObject(val) && !val.isMongooseBuffer) {\n          obj = obj.toObject({\n            transform: false,\n            virtuals: false,\n            depopulate: true,\n            getters: false,\n            flattenDecimals: false\n          });\n        }\n        if (val.isMongooseBuffer) {\n          obj = Buffer.from(obj);\n        }\n        exports.mergeClone(to[key], obj);\n      } else {\n        to[key] = exports.clone(val, {\n          flattenDecimals: false\n        });\n      }\n    }\n  }\n};\n\n/**\r\n * Executes a function on each element of an array (like _.each)\r\n *\r\n * @param {Array} arr\r\n * @param {Function} fn\r\n * @api private\r\n */\n\nexports.each = function (arr, fn) {\n  for (const item of arr) {\n    fn(item);\n  }\n};\n\n/*!\r\n * ignore\r\n */\n\nexports.getOption = function (name) {\n  const sources = Array.prototype.slice.call(arguments, 1);\n  for (const source of sources) {\n    if (source == null) {\n      continue;\n    }\n    if (source[name] != null) {\n      return source[name];\n    }\n  }\n  return null;\n};\n\n/*!\r\n * ignore\r\n */\n\nexports.noop = function () {};\nexports.errorToPOJO = function errorToPOJO(error) {\n  const isError = error instanceof Error;\n  if (!isError) {\n    throw new Error('`error` must be `instanceof Error`.');\n  }\n  const ret = {};\n  for (const properyName of Object.getOwnPropertyNames(error)) {\n    ret[properyName] = error[properyName];\n  }\n  return ret;\n};\n\n/*!\r\n * ignore\r\n */\n\nexports.warn = function warn(message) {\n  return process.emitWarning(message, {\n    code: 'MONGOOSE'\n  });\n};\nexports.injectTimestampsOption = function injectTimestampsOption(writeOperation, timestampsOption) {\n  if (timestampsOption == null) {\n    return;\n  }\n  writeOperation.timestamps = timestampsOption;\n};","map":{"version":3,"names":["ms","require","mpath","ObjectId","PopulateOptions","clone","immediate","isObject","isMongooseArray","isMongooseDocumentArray","isBsonType","getFunctionName","isMongooseObject","promiseOrCallback","schemaMerge","specialProperties","trustedSymbol","Document","exports","registerMongooseArray","registerMongooseDocumentArray","toCollectionName","name","pluralize","deepEqual","a","b","Date","getTime","toString","RegExp","source","ignoreCase","multiline","global","dotAll","unicode","sticky","hasIndices","prototype","Map","Array","from","keys","values","Number","valueOf","Buffer","isBuffer","buffer","areEqual","isArray","len","length","i","$__","_doc","toObject","ka","Object","kb","kaLength","key","last","arr","cloneArrays","map","el","omit","obj","assign","ret","options","defaults","k","merge","to","path","omitNested","has","isDiscriminatorSchemaMerge","$isSingleNested","$isMongooseDocumentArray","instanceOfSchema","overwrite","doc","push","isPOJO","arg","proto","getPrototypeOf","constructor","isNonBuiltinObject","val","isNativeObject","isMongooseType","Boolean","String","isEmptyObject","hasKey","props","prop","tick","callback","apply","arguments","err","v","expires","object","expireAfterSeconds","Math","round","populate","select","model","match","subPopulate","justOne","count","_docs","_childDocs","singles","makeSingles","o","TypeError","_populateObj","forEach","test","paths","split","p","copy","getValue","get","setValue","_copying","set","vals","shallowCopy","hop","hasOwnProperty","call","isNullOrUndefined","undefined","array","flatten","filter","item","_hasOwnProperty","hasUserDefinedProperty","MAX_ARRAY_INDEX","pow","isArrayIndex","unique","primitives","Set","ids","add","decorate","destination","mergeClone","fromObj","transform","virtuals","depopulate","getters","flattenDecimals","isMongooseBuffer","each","fn","getOption","sources","slice","noop","errorToPOJO","error","isError","Error","properyName","getOwnPropertyNames","warn","message","process","emitWarning","code","injectTimestampsOption","writeOperation","timestampsOption","timestamps"],"sources":["C:/Users/91930/Desktop/Github projects/Pharmacy Demo/back-end/node_modules/mongoose/lib/utils.js"],"sourcesContent":["'use strict';\r\n\r\n/*!\r\n * Module dependencies.\r\n */\r\n\r\nconst ms = require('ms');\r\nconst mpath = require('mpath');\r\nconst ObjectId = require('./types/objectid');\r\nconst PopulateOptions = require('./options/PopulateOptions');\r\nconst clone = require('./helpers/clone');\r\nconst immediate = require('./helpers/immediate');\r\nconst isObject = require('./helpers/isObject');\r\nconst isMongooseArray = require('./types/array/isMongooseArray');\r\nconst isMongooseDocumentArray = require('./types/DocumentArray/isMongooseDocumentArray');\r\nconst isBsonType = require('./helpers/isBsonType');\r\nconst getFunctionName = require('./helpers/getFunctionName');\r\nconst isMongooseObject = require('./helpers/isMongooseObject');\r\nconst promiseOrCallback = require('./helpers/promiseOrCallback');\r\nconst schemaMerge = require('./helpers/schema/merge');\r\nconst specialProperties = require('./helpers/specialProperties');\r\nconst { trustedSymbol } = require('./helpers/query/trusted');\r\n\r\nlet Document;\r\n\r\nexports.specialProperties = specialProperties;\r\n\r\nexports.isMongooseArray = isMongooseArray.isMongooseArray;\r\nexports.isMongooseDocumentArray = isMongooseDocumentArray.isMongooseDocumentArray;\r\nexports.registerMongooseArray = isMongooseArray.registerMongooseArray;\r\nexports.registerMongooseDocumentArray = isMongooseDocumentArray.registerMongooseDocumentArray;\r\n\r\n/**\r\n * Produces a collection name from model `name`. By default, just returns\r\n * the model name\r\n *\r\n * @param {String} name a model name\r\n * @param {Function} pluralize function that pluralizes the collection name\r\n * @return {String} a collection name\r\n * @api private\r\n */\r\n\r\nexports.toCollectionName = function(name, pluralize) {\r\n  if (name === 'system.profile') {\r\n    return name;\r\n  }\r\n  if (name === 'system.indexes') {\r\n    return name;\r\n  }\r\n  if (typeof pluralize === 'function') {\r\n    return pluralize(name);\r\n  }\r\n  return name;\r\n};\r\n\r\n/**\r\n * Determines if `a` and `b` are deep equal.\r\n *\r\n * Modified from node/lib/assert.js\r\n *\r\n * @param {any} a a value to compare to `b`\r\n * @param {any} b a value to compare to `a`\r\n * @return {Boolean}\r\n * @api private\r\n */\r\n\r\nexports.deepEqual = function deepEqual(a, b) {\r\n  if (a === b) {\r\n    return true;\r\n  }\r\n\r\n  if (typeof a !== 'object' || typeof b !== 'object') {\r\n    return a === b;\r\n  }\r\n\r\n  if (a instanceof Date && b instanceof Date) {\r\n    return a.getTime() === b.getTime();\r\n  }\r\n\r\n  if ((isBsonType(a, 'ObjectID') && isBsonType(b, 'ObjectID')) ||\r\n      (isBsonType(a, 'Decimal128') && isBsonType(b, 'Decimal128'))) {\r\n    return a.toString() === b.toString();\r\n  }\r\n\r\n  if (a instanceof RegExp && b instanceof RegExp) {\r\n    return a.source === b.source &&\r\n        a.ignoreCase === b.ignoreCase &&\r\n        a.multiline === b.multiline &&\r\n        a.global === b.global &&\r\n        a.dotAll === b.dotAll &&\r\n        a.unicode === b.unicode &&\r\n        a.sticky === b.sticky &&\r\n        a.hasIndices === b.hasIndices;\r\n  }\r\n\r\n  if (a == null || b == null) {\r\n    return false;\r\n  }\r\n\r\n  if (a.prototype !== b.prototype) {\r\n    return false;\r\n  }\r\n\r\n  if (a instanceof Map || b instanceof Map) {\r\n    if (!(a instanceof Map) || !(b instanceof Map)) {\r\n      return false;\r\n    }\r\n    return deepEqual(Array.from(a.keys()), Array.from(b.keys())) &&\r\n      deepEqual(Array.from(a.values()), Array.from(b.values()));\r\n  }\r\n\r\n  // Handle MongooseNumbers\r\n  if (a instanceof Number && b instanceof Number) {\r\n    return a.valueOf() === b.valueOf();\r\n  }\r\n\r\n  if (Buffer.isBuffer(a)) {\r\n    return exports.buffer.areEqual(a, b);\r\n  }\r\n\r\n  if (Array.isArray(a) || Array.isArray(b)) {\r\n    if (!Array.isArray(a) || !Array.isArray(b)) {\r\n      return false;\r\n    }\r\n    const len = a.length;\r\n    if (len !== b.length) {\r\n      return false;\r\n    }\r\n    for (let i = 0; i < len; ++i) {\r\n      if (!deepEqual(a[i], b[i])) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  if (a.$__ != null) {\r\n    a = a._doc;\r\n  } else if (isMongooseObject(a)) {\r\n    a = a.toObject();\r\n  }\r\n\r\n  if (b.$__ != null) {\r\n    b = b._doc;\r\n  } else if (isMongooseObject(b)) {\r\n    b = b.toObject();\r\n  }\r\n\r\n  const ka = Object.keys(a);\r\n  const kb = Object.keys(b);\r\n  const kaLength = ka.length;\r\n\r\n  // having the same number of owned properties (keys incorporates\r\n  // hasOwnProperty)\r\n  if (kaLength !== kb.length) {\r\n    return false;\r\n  }\r\n\r\n  // ~~~cheap key test\r\n  for (let i = kaLength - 1; i >= 0; i--) {\r\n    if (ka[i] !== kb[i]) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // equivalent values for every corresponding key, and\r\n  // ~~~possibly expensive deep test\r\n  for (const key of ka) {\r\n    if (!deepEqual(a[key], b[key])) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\n/**\r\n * Get the last element of an array\r\n * @param {Array} arr\r\n */\r\n\r\nexports.last = function(arr) {\r\n  if (arr.length > 0) {\r\n    return arr[arr.length - 1];\r\n  }\r\n  return void 0;\r\n};\r\n\r\nexports.clone = clone;\r\n\r\n/*!\r\n * ignore\r\n */\r\n\r\nexports.promiseOrCallback = promiseOrCallback;\r\n\r\n/*!\r\n * ignore\r\n */\r\n\r\nexports.cloneArrays = function cloneArrays(arr) {\r\n  if (!Array.isArray(arr)) {\r\n    return arr;\r\n  }\r\n\r\n  return arr.map(el => exports.cloneArrays(el));\r\n};\r\n\r\n/*!\r\n * ignore\r\n */\r\n\r\nexports.omit = function omit(obj, keys) {\r\n  if (keys == null) {\r\n    return Object.assign({}, obj);\r\n  }\r\n  if (!Array.isArray(keys)) {\r\n    keys = [keys];\r\n  }\r\n\r\n  const ret = Object.assign({}, obj);\r\n  for (const key of keys) {\r\n    delete ret[key];\r\n  }\r\n  return ret;\r\n};\r\n\r\n\r\n/**\r\n * Shallow copies defaults into options.\r\n *\r\n * @param {Object} defaults\r\n * @param {Object} [options]\r\n * @return {Object} the merged object\r\n * @api private\r\n */\r\n\r\nexports.options = function(defaults, options) {\r\n  const keys = Object.keys(defaults);\r\n  let i = keys.length;\r\n  let k;\r\n\r\n  options = options || {};\r\n\r\n  while (i--) {\r\n    k = keys[i];\r\n    if (!(k in options)) {\r\n      options[k] = defaults[k];\r\n    }\r\n  }\r\n\r\n  return options;\r\n};\r\n\r\n/**\r\n * Merges `from` into `to` without overwriting existing properties.\r\n *\r\n * @param {Object} to\r\n * @param {Object} from\r\n * @param {Object} [options]\r\n * @param {String} [path]\r\n * @api private\r\n */\r\n\r\nexports.merge = function merge(to, from, options, path) {\r\n  options = options || {};\r\n\r\n  const keys = Object.keys(from);\r\n  let i = 0;\r\n  const len = keys.length;\r\n  let key;\r\n\r\n  if (from[trustedSymbol]) {\r\n    to[trustedSymbol] = from[trustedSymbol];\r\n  }\r\n\r\n  path = path || '';\r\n  const omitNested = options.omitNested || {};\r\n\r\n  while (i < len) {\r\n    key = keys[i++];\r\n    if (options.omit && options.omit[key]) {\r\n      continue;\r\n    }\r\n    if (omitNested[path]) {\r\n      continue;\r\n    }\r\n    if (specialProperties.has(key)) {\r\n      continue;\r\n    }\r\n    if (to[key] == null) {\r\n      to[key] = from[key];\r\n    } else if (exports.isObject(from[key])) {\r\n      if (!exports.isObject(to[key])) {\r\n        to[key] = {};\r\n      }\r\n      if (from[key] != null) {\r\n        // Skip merging schemas if we're creating a discriminator schema and\r\n        // base schema has a given path as a single nested but discriminator schema\r\n        // has the path as a document array, or vice versa (gh-9534)\r\n        if (options.isDiscriminatorSchemaMerge &&\r\n            (from[key].$isSingleNested && to[key].$isMongooseDocumentArray) ||\r\n            (from[key].$isMongooseDocumentArray && to[key].$isSingleNested)) {\r\n          continue;\r\n        } else if (from[key].instanceOfSchema) {\r\n          if (to[key].instanceOfSchema) {\r\n            schemaMerge(to[key], from[key].clone(), options.isDiscriminatorSchemaMerge);\r\n          } else {\r\n            to[key] = from[key].clone();\r\n          }\r\n          continue;\r\n        } else if (isBsonType(from[key], 'ObjectID')) {\r\n          to[key] = new ObjectId(from[key]);\r\n          continue;\r\n        }\r\n      }\r\n      merge(to[key], from[key], options, path ? path + '.' + key : key);\r\n    } else if (options.overwrite) {\r\n      to[key] = from[key];\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * Applies toObject recursively.\r\n *\r\n * @param {Document|Array|Object} obj\r\n * @return {Object}\r\n * @api private\r\n */\r\n\r\nexports.toObject = function toObject(obj) {\r\n  Document || (Document = require('./document'));\r\n  let ret;\r\n\r\n  if (obj == null) {\r\n    return obj;\r\n  }\r\n\r\n  if (obj instanceof Document) {\r\n    return obj.toObject();\r\n  }\r\n\r\n  if (Array.isArray(obj)) {\r\n    ret = [];\r\n\r\n    for (const doc of obj) {\r\n      ret.push(toObject(doc));\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  if (exports.isPOJO(obj)) {\r\n    ret = {};\r\n\r\n    if (obj[trustedSymbol]) {\r\n      ret[trustedSymbol] = obj[trustedSymbol];\r\n    }\r\n\r\n    for (const k of Object.keys(obj)) {\r\n      if (specialProperties.has(k)) {\r\n        continue;\r\n      }\r\n      ret[k] = toObject(obj[k]);\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  return obj;\r\n};\r\n\r\nexports.isObject = isObject;\r\n\r\n/**\r\n * Determines if `arg` is a plain old JavaScript object (POJO). Specifically,\r\n * `arg` must be an object but not an instance of any special class, like String,\r\n * ObjectId, etc.\r\n *\r\n * `Object.getPrototypeOf()` is part of ES5: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/getPrototypeOf\r\n *\r\n * @param {Object|Array|String|Function|RegExp|any} arg\r\n * @api private\r\n * @return {Boolean}\r\n */\r\n\r\nexports.isPOJO = function isPOJO(arg) {\r\n  if (arg == null || typeof arg !== 'object') {\r\n    return false;\r\n  }\r\n  const proto = Object.getPrototypeOf(arg);\r\n  // Prototype may be null if you used `Object.create(null)`\r\n  // Checking `proto`'s constructor is safe because `getPrototypeOf()`\r\n  // explicitly crosses the boundary from object data to object metadata\r\n  return !proto || proto.constructor.name === 'Object';\r\n};\r\n\r\n/**\r\n * Determines if `arg` is an object that isn't an instance of a built-in value\r\n * class, like Array, Buffer, ObjectId, etc.\r\n * @param {Any} val\r\n */\r\n\r\nexports.isNonBuiltinObject = function isNonBuiltinObject(val) {\r\n  return typeof val === 'object' &&\r\n    !exports.isNativeObject(val) &&\r\n    !exports.isMongooseType(val) &&\r\n    val != null;\r\n};\r\n\r\n/**\r\n * Determines if `obj` is a built-in object like an array, date, boolean,\r\n * etc.\r\n * @param {Any} arg\r\n */\r\n\r\nexports.isNativeObject = function(arg) {\r\n  return Array.isArray(arg) ||\r\n    arg instanceof Date ||\r\n    arg instanceof Boolean ||\r\n    arg instanceof Number ||\r\n    arg instanceof String;\r\n};\r\n\r\n/**\r\n * Determines if `val` is an object that has no own keys\r\n * @param {Any} val\r\n */\r\n\r\nexports.isEmptyObject = function(val) {\r\n  return val != null &&\r\n    typeof val === 'object' &&\r\n    Object.keys(val).length === 0;\r\n};\r\n\r\n/**\r\n * Search if `obj` or any POJOs nested underneath `obj` has a property named\r\n * `key`\r\n * @param {Object} obj\r\n * @param {String} key\r\n */\r\n\r\nexports.hasKey = function hasKey(obj, key) {\r\n  const props = Object.keys(obj);\r\n  for (const prop of props) {\r\n    if (prop === key) {\r\n      return true;\r\n    }\r\n    if (exports.isPOJO(obj[prop]) && exports.hasKey(obj[prop], key)) {\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n};\r\n\r\n/**\r\n * process.nextTick helper.\r\n *\r\n * Wraps `callback` in a try/catch + nextTick.\r\n *\r\n * node-mongodb-native has a habit of state corruption when an error is immediately thrown from within a collection callback.\r\n *\r\n * @param {Function} callback\r\n * @api private\r\n */\r\n\r\nexports.tick = function tick(callback) {\r\n  if (typeof callback !== 'function') {\r\n    return;\r\n  }\r\n  return function() {\r\n    try {\r\n      callback.apply(this, arguments);\r\n    } catch (err) {\r\n      // only nextTick on err to get out of\r\n      // the event loop and avoid state corruption.\r\n      immediate(function() {\r\n        throw err;\r\n      });\r\n    }\r\n  };\r\n};\r\n\r\n/**\r\n * Returns true if `v` is an object that can be serialized as a primitive in\r\n * MongoDB\r\n * @param {Any} v\r\n */\r\n\r\nexports.isMongooseType = function(v) {\r\n  return isBsonType(v, 'ObjectID') || isBsonType(v, 'Decimal128') || v instanceof Buffer;\r\n};\r\n\r\nexports.isMongooseObject = isMongooseObject;\r\n\r\n/**\r\n * Converts `expires` options of index objects to `expiresAfterSeconds` options for MongoDB.\r\n *\r\n * @param {Object} object\r\n * @api private\r\n */\r\n\r\nexports.expires = function expires(object) {\r\n  if (!(object && object.constructor.name === 'Object')) {\r\n    return;\r\n  }\r\n  if (!('expires' in object)) {\r\n    return;\r\n  }\r\n\r\n  object.expireAfterSeconds = (typeof object.expires !== 'string')\r\n    ? object.expires\r\n    : Math.round(ms(object.expires) / 1000);\r\n  delete object.expires;\r\n};\r\n\r\n/**\r\n * populate helper\r\n * @param {String} path\r\n * @param {String} select\r\n * @param {Model} model\r\n * @param {Object} match\r\n * @param {Object} options\r\n * @param {Any} subPopulate\r\n * @param {Boolean} justOne\r\n * @param {Boolean} count\r\n */\r\n\r\nexports.populate = function populate(path, select, model, match, options, subPopulate, justOne, count) {\r\n  // might have passed an object specifying all arguments\r\n  let obj = null;\r\n  if (arguments.length === 1) {\r\n    if (path instanceof PopulateOptions) {\r\n      // If reusing old populate docs, avoid reusing `_docs` because that may\r\n      // lead to bugs and memory leaks. See gh-11641\r\n      path._docs = [];\r\n      path._childDocs = [];\r\n      return [path];\r\n    }\r\n\r\n    if (Array.isArray(path)) {\r\n      const singles = makeSingles(path);\r\n      return singles.map(o => exports.populate(o)[0]);\r\n    }\r\n\r\n    if (exports.isObject(path)) {\r\n      obj = Object.assign({}, path);\r\n    } else {\r\n      obj = { path: path };\r\n    }\r\n  } else if (typeof model === 'object') {\r\n    obj = {\r\n      path: path,\r\n      select: select,\r\n      match: model,\r\n      options: match\r\n    };\r\n  } else {\r\n    obj = {\r\n      path: path,\r\n      select: select,\r\n      model: model,\r\n      match: match,\r\n      options: options,\r\n      populate: subPopulate,\r\n      justOne: justOne,\r\n      count: count\r\n    };\r\n  }\r\n\r\n  if (typeof obj.path !== 'string') {\r\n    throw new TypeError('utils.populate: invalid path. Expected string. Got typeof `' + typeof path + '`');\r\n  }\r\n\r\n  return _populateObj(obj);\r\n\r\n  // The order of select/conditions args is opposite Model.find but\r\n  // necessary to keep backward compatibility (select could be\r\n  // an array, string, or object literal).\r\n  function makeSingles(arr) {\r\n    const ret = [];\r\n    arr.forEach(function(obj) {\r\n      if (/[\\s]/.test(obj.path)) {\r\n        const paths = obj.path.split(' ');\r\n        paths.forEach(function(p) {\r\n          const copy = Object.assign({}, obj);\r\n          copy.path = p;\r\n          ret.push(copy);\r\n        });\r\n      } else {\r\n        ret.push(obj);\r\n      }\r\n    });\r\n\r\n    return ret;\r\n  }\r\n};\r\n\r\nfunction _populateObj(obj) {\r\n  if (Array.isArray(obj.populate)) {\r\n    const ret = [];\r\n    obj.populate.forEach(function(obj) {\r\n      if (/[\\s]/.test(obj.path)) {\r\n        const copy = Object.assign({}, obj);\r\n        const paths = copy.path.split(' ');\r\n        paths.forEach(function(p) {\r\n          copy.path = p;\r\n          ret.push(exports.populate(copy)[0]);\r\n        });\r\n      } else {\r\n        ret.push(exports.populate(obj)[0]);\r\n      }\r\n    });\r\n    obj.populate = exports.populate(ret);\r\n  } else if (obj.populate != null && typeof obj.populate === 'object') {\r\n    obj.populate = exports.populate(obj.populate);\r\n  }\r\n\r\n  const ret = [];\r\n  const paths = obj.path.split(' ');\r\n  if (obj.options != null) {\r\n    obj.options = exports.clone(obj.options);\r\n  }\r\n\r\n  for (const path of paths) {\r\n    ret.push(new PopulateOptions(Object.assign({}, obj, { path: path })));\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\n/**\r\n * Return the value of `obj` at the given `path`.\r\n *\r\n * @param {String} path\r\n * @param {Object} obj\r\n * @param {Any} map\r\n */\r\n\r\nexports.getValue = function(path, obj, map) {\r\n  return mpath.get(path, obj, '_doc', map);\r\n};\r\n\r\n/**\r\n * Sets the value of `obj` at the given `path`.\r\n *\r\n * @param {String} path\r\n * @param {Anything} val\r\n * @param {Object} obj\r\n * @param {Any} map\r\n * @param {Any} _copying\r\n */\r\n\r\nexports.setValue = function(path, val, obj, map, _copying) {\r\n  mpath.set(path, val, obj, '_doc', map, _copying);\r\n};\r\n\r\n/**\r\n * Returns an array of values from object `o`.\r\n *\r\n * @param {Object} o\r\n * @return {Array}\r\n * @api private\r\n */\r\n\r\nexports.object = {};\r\nexports.object.vals = function vals(o) {\r\n  const keys = Object.keys(o);\r\n  let i = keys.length;\r\n  const ret = [];\r\n\r\n  while (i--) {\r\n    ret.push(o[keys[i]]);\r\n  }\r\n\r\n  return ret;\r\n};\r\n\r\n/**\r\n * @see exports.options\r\n */\r\n\r\nexports.object.shallowCopy = exports.options;\r\n\r\nconst hop = Object.prototype.hasOwnProperty;\r\n\r\n/**\r\n * Safer helper for hasOwnProperty checks\r\n *\r\n * @param {Object} obj\r\n * @param {String} prop\r\n */\r\n\r\nexports.object.hasOwnProperty = function(obj, prop) {\r\n  return hop.call(obj, prop);\r\n};\r\n\r\n/**\r\n * Determine if `val` is null or undefined\r\n *\r\n * @param {Any} val\r\n * @return {Boolean}\r\n */\r\n\r\nexports.isNullOrUndefined = function(val) {\r\n  return val === null || val === undefined;\r\n};\r\n\r\n/*!\r\n * ignore\r\n */\r\n\r\nexports.array = {};\r\n\r\n/**\r\n * Flattens an array.\r\n *\r\n * [ 1, [ 2, 3, [4] ]] -> [1,2,3,4]\r\n *\r\n * @param {Array} arr\r\n * @param {Function} [filter] If passed, will be invoked with each item in the array. If `filter` returns a falsy value, the item will not be included in the results.\r\n * @param {Array} ret\r\n * @return {Array}\r\n * @api private\r\n */\r\n\r\nexports.array.flatten = function flatten(arr, filter, ret) {\r\n  ret || (ret = []);\r\n\r\n  arr.forEach(function(item) {\r\n    if (Array.isArray(item)) {\r\n      flatten(item, filter, ret);\r\n    } else {\r\n      if (!filter || filter(item)) {\r\n        ret.push(item);\r\n      }\r\n    }\r\n  });\r\n\r\n  return ret;\r\n};\r\n\r\n/*!\r\n * ignore\r\n */\r\n\r\nconst _hasOwnProperty = Object.prototype.hasOwnProperty;\r\n\r\nexports.hasUserDefinedProperty = function(obj, key) {\r\n  if (obj == null) {\r\n    return false;\r\n  }\r\n\r\n  if (Array.isArray(key)) {\r\n    for (const k of key) {\r\n      if (exports.hasUserDefinedProperty(obj, k)) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  if (_hasOwnProperty.call(obj, key)) {\r\n    return true;\r\n  }\r\n  if (typeof obj === 'object' && key in obj) {\r\n    const v = obj[key];\r\n    return v !== Object.prototype[key] && v !== Array.prototype[key];\r\n  }\r\n\r\n  return false;\r\n};\r\n\r\n/*!\r\n * ignore\r\n */\r\n\r\nconst MAX_ARRAY_INDEX = Math.pow(2, 32) - 1;\r\n\r\nexports.isArrayIndex = function(val) {\r\n  if (typeof val === 'number') {\r\n    return val >= 0 && val <= MAX_ARRAY_INDEX;\r\n  }\r\n  if (typeof val === 'string') {\r\n    if (!/^\\d+$/.test(val)) {\r\n      return false;\r\n    }\r\n    val = +val;\r\n    return val >= 0 && val <= MAX_ARRAY_INDEX;\r\n  }\r\n\r\n  return false;\r\n};\r\n\r\n/**\r\n * Removes duplicate values from an array\r\n *\r\n * [1, 2, 3, 3, 5] => [1, 2, 3, 5]\r\n * [ ObjectId(\"550988ba0c19d57f697dc45e\"), ObjectId(\"550988ba0c19d57f697dc45e\") ]\r\n *    => [ObjectId(\"550988ba0c19d57f697dc45e\")]\r\n *\r\n * @param {Array} arr\r\n * @return {Array}\r\n * @api private\r\n */\r\n\r\nexports.array.unique = function(arr) {\r\n  const primitives = new Set();\r\n  const ids = new Set();\r\n  const ret = [];\r\n\r\n  for (const item of arr) {\r\n    if (typeof item === 'number' || typeof item === 'string' || item == null) {\r\n      if (primitives.has(item)) {\r\n        continue;\r\n      }\r\n      ret.push(item);\r\n      primitives.add(item);\r\n    } else if (isBsonType(item, 'ObjectID')) {\r\n      if (ids.has(item.toString())) {\r\n        continue;\r\n      }\r\n      ret.push(item);\r\n      ids.add(item.toString());\r\n    } else {\r\n      ret.push(item);\r\n    }\r\n  }\r\n\r\n  return ret;\r\n};\r\n\r\nexports.buffer = {};\r\n\r\n/**\r\n * Determines if two buffers are equal.\r\n *\r\n * @param {Buffer} a\r\n * @param {Object} b\r\n */\r\n\r\nexports.buffer.areEqual = function(a, b) {\r\n  if (!Buffer.isBuffer(a)) {\r\n    return false;\r\n  }\r\n  if (!Buffer.isBuffer(b)) {\r\n    return false;\r\n  }\r\n  if (a.length !== b.length) {\r\n    return false;\r\n  }\r\n  for (let i = 0, len = a.length; i < len; ++i) {\r\n    if (a[i] !== b[i]) {\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n};\r\n\r\nexports.getFunctionName = getFunctionName;\r\n\r\n/**\r\n * Decorate buffers\r\n * @param {Object} destination\r\n * @param {Object} source\r\n */\r\n\r\nexports.decorate = function(destination, source) {\r\n  for (const key in source) {\r\n    if (specialProperties.has(key)) {\r\n      continue;\r\n    }\r\n    destination[key] = source[key];\r\n  }\r\n};\r\n\r\n/**\r\n * merges to with a copy of from\r\n *\r\n * @param {Object} to\r\n * @param {Object} fromObj\r\n * @api private\r\n */\r\n\r\nexports.mergeClone = function(to, fromObj) {\r\n  if (isMongooseObject(fromObj)) {\r\n    fromObj = fromObj.toObject({\r\n      transform: false,\r\n      virtuals: false,\r\n      depopulate: true,\r\n      getters: false,\r\n      flattenDecimals: false\r\n    });\r\n  }\r\n  const keys = Object.keys(fromObj);\r\n  const len = keys.length;\r\n  let i = 0;\r\n  let key;\r\n\r\n  while (i < len) {\r\n    key = keys[i++];\r\n    if (specialProperties.has(key)) {\r\n      continue;\r\n    }\r\n    if (typeof to[key] === 'undefined') {\r\n      to[key] = exports.clone(fromObj[key], {\r\n        transform: false,\r\n        virtuals: false,\r\n        depopulate: true,\r\n        getters: false,\r\n        flattenDecimals: false\r\n      });\r\n    } else {\r\n      let val = fromObj[key];\r\n      if (val != null && val.valueOf && !(val instanceof Date)) {\r\n        val = val.valueOf();\r\n      }\r\n      if (exports.isObject(val)) {\r\n        let obj = val;\r\n        if (isMongooseObject(val) && !val.isMongooseBuffer) {\r\n          obj = obj.toObject({\r\n            transform: false,\r\n            virtuals: false,\r\n            depopulate: true,\r\n            getters: false,\r\n            flattenDecimals: false\r\n          });\r\n        }\r\n        if (val.isMongooseBuffer) {\r\n          obj = Buffer.from(obj);\r\n        }\r\n        exports.mergeClone(to[key], obj);\r\n      } else {\r\n        to[key] = exports.clone(val, {\r\n          flattenDecimals: false\r\n        });\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * Executes a function on each element of an array (like _.each)\r\n *\r\n * @param {Array} arr\r\n * @param {Function} fn\r\n * @api private\r\n */\r\n\r\nexports.each = function(arr, fn) {\r\n  for (const item of arr) {\r\n    fn(item);\r\n  }\r\n};\r\n\r\n/*!\r\n * ignore\r\n */\r\n\r\nexports.getOption = function(name) {\r\n  const sources = Array.prototype.slice.call(arguments, 1);\r\n\r\n  for (const source of sources) {\r\n    if (source == null) {\r\n      continue;\r\n    }\r\n    if (source[name] != null) {\r\n      return source[name];\r\n    }\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\n/*!\r\n * ignore\r\n */\r\n\r\nexports.noop = function() {};\r\n\r\nexports.errorToPOJO = function errorToPOJO(error) {\r\n  const isError = error instanceof Error;\r\n  if (!isError) {\r\n    throw new Error('`error` must be `instanceof Error`.');\r\n  }\r\n\r\n  const ret = {};\r\n  for (const properyName of Object.getOwnPropertyNames(error)) {\r\n    ret[properyName] = error[properyName];\r\n  }\r\n  return ret;\r\n};\r\n\r\n/*!\r\n * ignore\r\n */\r\n\r\nexports.warn = function warn(message) {\r\n  return process.emitWarning(message, { code: 'MONGOOSE' });\r\n};\r\n\r\n\r\nexports.injectTimestampsOption = function injectTimestampsOption(writeOperation, timestampsOption) {\r\n  if (timestampsOption == null) {\r\n    return;\r\n  }\r\n  writeOperation.timestamps = timestampsOption;\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}